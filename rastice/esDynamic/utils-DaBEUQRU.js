import{bI as z,bJ as L,bw as O,bK as T,ap as V,bL as A,B,bc as D}from"./main-CvsyIoCL.js";import{j as P}from"./quantizationUtils-Caf_RX94.js";import{l as R,u as Y}from"./heatmapUtils-D5umFjoc.js";import{$ as _}from"./utils-CbICP2qN.js";import{m as E,B as j}from"./utils-DPvcwaNr.js";let c=null;const J=/^(?<hh>([0-1][0-9])|([2][0-3])):(?<mm>[0-5][0-9])(:(?<ss>[0-5][0-9]))?([.](?<ms>\d+))?$/;function U(n,e,s){return n.x<0?n.x+=e:n.x>s&&(n.x-=e),n}function H(n,e,s,o){const t=z(s)?L(s):null,m=t?Math.round((t.valid[1]-t.valid[0])/e.scale[0]):null;return n.map(r=>{const i=new O(r.geometry);return P(e,i,i),r.geometry=t?U(i,m??0,o[0]):i,r})}function K(n,e=18,s,o,t){const m=new Float64Array(o*t);e=Math.round(D(e));let r=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY;const M=Y(s);for(const{geometry:p,attributes:g}of n){const{x,y:u}=p,I=Math.max(0,x-e),F=Math.max(0,u-e),$=Math.min(t,u+e),w=Math.min(o,x+e),b=+M(g);for(let f=F;f<$;f++)for(let d=I;d<w;d++){const y=f*o+d,N=R(d-x,f-u,e)*b,l=m[y]+=N;r=Math.min(r,l),i=Math.max(i,l)}}return{min:r,max:i}}function C(n){const e=J.exec(n);if(!e)return null;const{hh:s,mm:o,ss:t,ms:m}=e.groups;return Number(s)*T.hours+Number(o)*T.minutes+Number(t)*T.seconds+Number(m||0)}async function Q(n,e,s=!0){if(!e)return[];const{field:o,field2:t,field3:m,fieldDelimiter:r,fieldInfos:i,timeZone:M}=n,p=o&&i?.find(l=>l.name.toLowerCase()===o.toLowerCase()),g=!!p&&V(p),x=!!p&&_(p),u=n.valueExpression,I=n.normalizationType,F=n.normalizationField,$=n.normalizationTotal,w=[],b=n.viewInfoParams;let f=null,d=null;if(u){if(!c){const{arcadeUtils:l}=await A();c=l}c.hasGeometryOperations(u)&&await c.enableGeometryOperations(),f=c.createFunction(u),d=b?c.getViewInfo({viewingMode:b.viewingMode,scale:b.scale,spatialReference:new B(b.spatialReference)}):null}const y=n.fieldInfos,N=!(e[0]&&"declaredClass"in e[0]&&e[0].declaredClass==="esri.Graphic")&&y?{fields:y}:null;return e.forEach(l=>{const h=l.attributes;let a;if(u){const v=N?{...l,layer:N}:l,G=c.createExecContext(v,d,M);a=c.executeFunction(f,G)}else h&&(a=h[o],t?(a=`${E(a)}${r}${E(h[t])}`,m&&(a=`${a}${r}${E(h[m])}`)):typeof a=="string"&&s&&(x?a=a?new Date(a).getTime():null:g&&(a=a?C(a):null)));if(I&&typeof a=="number"&&isFinite(a)){const v=h&&parseFloat(h[F]);a=j(a,I,v,$)}w.push(a)}),w}export{C as I,Q as b,K as w,H as x};
