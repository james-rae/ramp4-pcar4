const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-BmDzRzJ5.js","./main-CUxU9bWS.js","./preload-helper-ExcqyqRp.js","./main-wZMPJMua.css","./Relationship-BSxuhPbM.js"])))=>i.map(i=>d[i]);
import{_ as E}from"./preload-helper-ExcqyqRp.js";import{b as x,K,D as I,cQ as P,a2 as N,cR as Q}from"./main-CUxU9bWS.js";import{t as J,N as T}from"./arcadeUtils-B9Zo114Q.js";import{i as W,a as l,r as u,d as b,P as w,$ as V,Y as j,E as v,B as M,z as G,k as D,t as B,g as C,T as L,Z as q,_ as O}from"./languageUtils-yuBlGFLc.js";import{l as z}from"./portalUtils-BKwkPmpA.js";import{_ as U,W as Y,K as Z}from"./projection-BIYcHcNR.js";import H from"./PortalItem-Ch5wKdnK.js";import{p as X,n as $}from"./project-BgW0gDoc.js";import{s as tt,m as nt,t as rt,p as et,c as at}from"./Relationship-BSxuhPbM.js";import"./TimeOnly-UPu6MbGY.js";import"./UnknownTimeZone-3zgfWq7J.js";import"./ImmutableArray-BPVd6ESQ.js";import"./featureConversionUtils-gwo6XIWk.js";import"./OptimizedFeature-CIptWNVu.js";import"./OptimizedFeatureSet-Blu9Ckm7.js";import"./FieldsIndex-DosTqN4i.js";import"./number-DwGyQ0sy.js";import"./shared-CYUZHEYe.js";import"./Field-7yKaqquJ.js";import"./fieldType-RAe-KhZA.js";import"./uuid-Cl5lrJ4c.js";import"./Query-gAxGVVkN.js";import"./projectBuffer-B22kEXxF.js";let f=null;async function it(t){const n=K.geometryServiceUrl??"";if(!n){U()||await Y();for(const r of t)r.container[r.indexer]=Z(r.container[r.indexer],I.WGS84);return}const e=t.map(r=>r.container[r.indexer]),i=new X({geometries:e,outSpatialReference:I.WGS84}),s=await $(n,i);for(let r=0;r<s.length;r++){const a=t[r];a.container[a.indexer]=s[r]}}async function k(t,n){const e=new H({portal:t,id:n});return await e.load(),f===null&&(f=await E(()=>import("./knowledgeGraphService-BmDzRzJ5.js").then(i=>i.k),__vite__mapDeps([0,1,2,3,4]),import.meta.url)),await f.fetchKnowledgeGraph(e.url)}function S(t,n,e,i,s){if(t===null)return null;if(w(t)||G(t))return t;if(D(t)||D(t))return t.toJSDate();if(B(t))return t.toStorageFormat();if(C(t))return t.toStorageString();if(L(t)){const r={};for(const a of t.keys())r[a]=S(t.field(a),n,e,i,s),r[a]instanceof P&&s.push({container:r,indexer:a});return r}if(v(t)){const r=t.map(a=>S(a,n,e,i,s));for(let a=0;a<r.length;a++)r[a]instanceof P&&s.push({container:r,indexer:a});return r}return q(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&n?N(t):t:void 0}function ot(t,n){if(!t)return t;if(t.spatialReference.isWGS84&&n.spatialReference.isWebMercator)return Q(t);if(t.spatialReference.equals(n.spatialReference))return t;throw new l(n,u.WrongSpatialReference,null)}function R(t,n){if(!t)return null;const e={};for(const i in t)e[i]=m(t[i],n);return e}function m(t,n){return t===null?null:v(t)?t.map(e=>m(e,n)):t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:R(t.properties,n)}:t instanceof rt?{graphType:"object",properties:R(t.properties,n)}:t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:R(t.properties,n)}:t instanceof at?{graphType:"path",path:t.path?t.path.map(e=>m(e,n)):null}:q(t)?ot(t,n):w(t)||G(t)||O(t)?t:null}function kt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(n,e){return t.standardFunctionAsync(n,e,(i,s,r)=>{if(W(r,2,2,n,e),r[0]===null)throw new l(n,u.PortalRequired,e);if(r[0]instanceof J){const d=b(r[1]);let c;return c=n.services?.portal?n.services.portal:x.getDefault(),k(z(r[0],c),d)}if(w(r[0])===!1)throw new l(n,u.InvalidParameter,e);const a=b(r[0]);return k(n.services?.portal??x.getDefault(),a)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(n,e){return t.standardFunctionAsync(n,e,async(i,s,r)=>{W(r,2,4,n,e);const a=r[0];if(!V(a))throw new l(n,u.InvalidParameter,e);const d=r[1];if(!w(d))throw new l(n,u.InvalidParameter,e);f===null&&(f=await E(()=>import("./knowledgeGraphService-BmDzRzJ5.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4]),import.meta.url));let c=null;const h=j(r[2],null);if(!(h instanceof T||h===null))throw new l(n,u.InvalidParameter,e);if(h){let o=[];c=S(h,!0,!1,n,o),o=o.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),o.length>0&&await it(o)}const _=new tt({openCypherQuery:d,bindParameters:c});(a?.serviceDefinition?.currentVersion??11.3)>11.2&&(_.outputSpatialReference=n.spatialReference);const A=(await f.executeQueryStreaming(a,_)).resultRowsStream.getReader(),y=[];try{for(;;){const{done:o,value:p}=await A.read();if(o)break;if(v(p))for(const g of p)y.push(m(g,n));else{const g=[];for(const F of p)g.push(m(p[F],n));y.push(g)}}}catch(o){throw o}return T.convertJsonToArcade(y,M(n),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{kt as registerFunctions};
