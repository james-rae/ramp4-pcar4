import{bp as l,bq as y}from"./main-6quFNups.js";import{a as b}from"./CIMSymbolHelper-CHB_SGJd.js";import{CIMSymbolRasterizer as j}from"./CIMSymbolRasterizer-YacHbJ_k.js";import{OverrideHelper as R}from"./OverrideHelper-DUdTbzpQ.js";import{V}from"./utils-BRg6PM3S.js";import{t as S,l as q}from"./utils-CWIqSCKz.js";import"./preload-helper-ExcqyqRp.js";import"./BidiEngine-DNnuvc1i.js";import"./fontUtils-_HBfSKPq.js";import"./OptimizedGeometry-BuHcxlp9.js";import"./memoryEstimations-BxOZ4r8L.js";import"./Rect-BPZqtwUW.js";import"./enums-BJSSbDkD.js";import"./defaultCIMValues-DII_GG3u.js";import"./rasterizingUtils-BFMcZzyz.js";import"./floatRGBA-yrFAp4es.js";import"./definitions-CPtb4TQS.js";import"./mat2d-D9DBP-jx.js";import"./common-DQOJ18NT.js";import"./mat2df32-orApM5a3.js";import"./vec2-maR1OrZI.js";import"./vec2f32-BbH2jxlN.js";import"./BoundingBox-CnpCxTZE.js";import"./CIMResourceManager-lYs0lq4t.js";import"./imageUtils-BVPGnyKk.js";import"./colorUtils-DPaHwmQW.js";import"./vec42-CKs01hkn.js";import"./vec4f64-o2zAXfmz.js";import"./callExpressionWithFeature-OcsIROdV.js";import"./quantizationUtils-CJIa_aSr.js";import"./globalCss-C4MV-dFx.js";import"./Queue-C89HhVJm.js";import"./signal-BQC6Vdrb.js";import"./Version-CoyC2tgY.js";import"./jsxFactory-C-ojz6ZC.js";import"./intl-AgB03gne.js";import"./uuid-Cl5lrJ4c.js";import"./utils-BHOhSPln.js";import"./jsonUtils-BrFJv-ex.js";import"./parser-B5NINrTS.js";import"./mat4f32-DcsiF_Rp.js";import"./mat4-C5nbHoGE.js";import"./cimSymbolUtils-DmqcM7BN.js";import"./LRUCache-GR-vwTOR.js";import"./MemCache-CoWn1tSU.js";import"./webStyleSymbolUtils-DyrlD3lx.js";import"./devEnvironmentUtils-8WtPGj6h.js";import"./styleUtils-Cyx0DU2V.js";import"./webStyleAcceptedFormats-CG7ZQ6BV.js";import"./ColorStop-Cg0suDWN.js";import"./TimeExtent-DzeR00n-.js";import"./utils-D3C_5Lhl.js";import"./timeZoneUtils-DWgWPlk8.js";import"./typeUtils-CiQj6ysI.js";import"./ClassBreaksRenderer-DJmXCbPP.js";import"./commonProperties-CV_VfJJq.js";import"./colorRamps-Cr7MNJjy.js";import"./visualVariableUtils-B10Gj4Ci.js";import"./lengthUtils-BTGF2ler.js";import"./RendererLegendOptions-CCgMyP2A.js";import"./FieldsIndex-D1boLpiw.js";import"./heatmapUtils-C3sL6bR7.js";import"./SimpleRenderer-Dkk5NN3Z.js";import"./UniqueValueRenderer-DGrRI7L8.js";import"./diffUtils-b8I5DNqw.js";const f=new j(null),u=l(S.size),P=l(S.maxSize),M=l(S.lineWidth),D=1;async function E(a,t,n){const e=t?.size;let i=e!=null&&typeof e=="object"&&"width"in e?e.width:e,r=e!=null&&typeof e=="object"&&"height"in e?e.height:e;if(i==null||r==null)if(n==="esriGeometryPolygon")i=r=t.maxSize?Math.min(t.maxSize,u):u;else{const o=await U(a,t,n);o&&(i=o.width,r=o.height),n==="esriGeometryPolyline"&&(i=t.maxSize?Math.min(t.maxSize,M):M),i=i!=null&&isFinite(i)?Math.min(i,P):u,r=r!=null&&isFinite(r)?Math.max(Math.min(r,P),D):u}return t.style==="legend"&&n==="esriGeometryPolyline"&&(i=M),{width:i,height:r}}async function U(a,t,n){const{feature:e,fieldMap:i,viewParams:r}=t.cimOptions||t,o=await R.resolveSymbolOverrides(a.data,e,null,i,n,null,r);if(!o)return null;(a=a.clone()).data={type:"CIMSymbolReference",symbol:o},a.data.primitiveOverrides=void 0;const p=[];return b.fetchResources(o,f.resourceManager,p),b.fetchFonts(o,f.resourceManager,p),p.length>0&&await Promise.all(p),b.getEnvelope(o,null,f.resourceManager)}async function Yt(a,t={}){const{node:n,opacity:e,symbolConfig:i}=t,r=i!=null&&typeof i=="object"&&"isSquareFill"in i&&i.isSquareFill,o=t.cimOptions||t,p=o.geometryType||V(a?.data?.symbol),m=await E(a,t,p),{feature:C,fieldMap:G}=o,I=t?.geometry||r||p!=="esriGeometryPolygon"?"preview":"legend";let v=m;const x=m;if(t?.geometry&&(p==="esriGeometryPolygon"||p==="esriGeometryPolyline")&&(y(m.width)<200||y(m.height)<200)){const F=m.width>m.height?l(200)*m.height/m.width:l(200);v={width:m.width>m.height?l(200):l(200)*m.width/m.height,height:F}}const g=await f.rasterizeCIMSymbolAsync(a,C,v,I,G,p,null,o.viewParams,o.allowScalingUp,t?.geometry?.toJSON());if(!g)return null;const{width:L,height:O}=g,h=document.createElement("canvas");h.width=L,h.height=O,h.getContext("2d").putImageData(g,0,0);const d=y(x.width),w=y(x.height),s=new Image(d,w);s.src=h.toDataURL(),s.ariaLabel=t.ariaLabel??null,s.alt=t.ariaLabel??"",e!=null&&(s.style.opacity=`${e}`);let c=s;if(t.effectView!=null){const z={shape:{type:"image",x:0,y:0,width:d,height:w,src:s.src},fill:null,stroke:null,offset:[0,0]};c=q([[z]],[d,w],{effectView:t.effectView,ariaLabel:t.ariaLabel})}return n&&c&&n.appendChild(c),c}export{Yt as previewCIMSymbol};
