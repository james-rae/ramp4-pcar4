const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./geometryEngineJSON-CoEI2ElB.js","./geometryEngineBase-CfyzjpMT.js","./main-CGBWc59Z.js","./preload-helper-dJJaZANz.js","./main-CY4W0263.css","./json-DYk0G9qS.js"])))=>i.map(i=>d[i]);
import { C as C$1 } from './enums-CwcDCDam.js';
import { dw as e$5, ov as t$2, N as has, aA as u$4, s as s$8, G as n$7, db as u$5, ow as z$2, aB as e$7, ox as S$4, jo as n$9, oy as a$7, jp as i$c, oz as s$a } from './main-CGBWc59Z.js';
import { Q, A as A$2, i as s$6, g as a$6, C as C$2, q as q$1, B as B$2, S as S$3, w as w$3, j as g$2, m as s$9, o as i$a, F, H, O, D as D$1, E as E$1, p as o$8 } from './UpdateTracking2D-tfVHyc-s.js';
import { g as e$4, i as i$7, l as l$4 } from './GeometryUtils-MaZzdDt5.js';
import { a as a$4, c as rt, t as tt, R as R$1, d as Bt, e as zt, V, A as A$3 } from './definitions-BdwlvHBE.js';
import { a as a$5, i as i$8, c as c$6 } from './TurboLine-C0HR_g--.js';
import { a as t$3, e as o$7, f as s$7, g as i$9 } from './LabelMetric-DeEwVo6w.js';
import './earcut-BQ3wmzD6.js';
import { t as t$4 } from './constants-BNnV1ogR.js';
import { U, e as e$6, w as w$2, n as n$8, i as i$b } from './enums-CHdyfzUK.js';
import { _ as __vitePreload } from './preload-helper-dJJaZANz.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function e$3(e,t,r,i,u,o,l){D=0;const y=(i-r)*o,p=u&&u.length,c=p?(u[0]-r)*o:y;let v,s,h,d,Z,a=n$6(t,r,i,0,c,o,!0);if(a&&a.next!==a.prev){if(p&&(a=f$4(t,r,i,u,a,o)),y>80*o){v=h=t[0+r*o],s=d=t[1+r*o];for(let e=o;e<c;e+=o){const n=t[e+r*o],x=t[e+1+r*o];v=Math.min(v,n),s=Math.min(s,x),h=Math.max(h,n),d=Math.max(d,x);}Z=Math.max(h-v,d-s),Z=0!==Z?1/Z:0;}x$3(a,e,o,v,s,Z,l,0);}}function n$6(e,n,t,x,r,i,l){let f;if(l===Z(e,n,t,x,r,i)>0)for(let o=x;o<r;o+=i)f=u$3(o+n*i,e[o+n*i],e[o+1+n*i],f);else for(let o=r-i;o>=x;o-=i)f=u$3(o+n*i,e[o+n*i],e[o+1+n*i],f);return f&&M$2(f,f.next)&&(o$6(f),f=f.next),f}function t$1(e,n=e){if(!e)return e;let t,x=e;do{if(t=!1,x.steiner||!M$2(x,x.next)&&0!==s$5(x.prev,x,x.next))x=x.next;else {if(o$6(x),x=n=x.prev,x===x.next)break;t=!0;}}while(t||x!==n);return n}function x$3(e,n,u,l,f,y,p,v){if(!e)return;!v&&y&&(e=c$5(e,l,f,y));let s=e;for(;e.prev!==e.next;){const c=e.prev,h=e.next;if(y?i$6(e,l,f,y):r$2(e))n.push(c.index/u+p),n.push(e.index/u+p),n.push(h.index/u+p),o$6(e),e=h.next,s=h.next;else if((e=h)===s){v?1===v?x$3(e=b$2(e,n,u,p),n,u,l,f,y,p,2):2===v&&g$1(e,n,u,l,f,y,p):x$3(t$1(e),n,u,l,f,y,p,1);break}}}function r$2(e){const n=e.prev,t=e,x=e.next;if(s$5(n,t,x)>=0)return !1;let r=e.next.next;const i=r;let u=0;for(;r!==e.prev&&(0===u||r!==i);){if(u++,a$3(n.x,n.y,t.x,t.y,x.x,x.y,r.x,r.y)&&s$5(r.prev,r,r.next)>=0)return !1;r=r.next;}return !0}function i$6(e,n,t,x){const r=e.prev,i=e,u=e.next;if(s$5(r,i,u)>=0)return !1;const o=r.x<i.x?r.x<u.x?r.x:u.x:i.x<u.x?i.x:u.x,l=r.y<i.y?r.y<u.y?r.y:u.y:i.y<u.y?i.y:u.y,f=r.x>i.x?r.x>u.x?r.x:u.x:i.x>u.x?i.x:u.x,y=r.y>i.y?r.y>u.y?r.y:u.y:i.y>u.y?i.y:u.y,p=z$1(o,l,n,t,x),c=z$1(f,y,n,t,x);let v=e.prevZ,h=e.nextZ;for(;v&&v.z>=p&&h&&h.z<=c;){if(v!==e.prev&&v!==e.next&&a$3(r.x,r.y,i.x,i.y,u.x,u.y,v.x,v.y)&&s$5(v.prev,v,v.next)>=0)return !1;if(v=v.prevZ,h!==e.prev&&h!==e.next&&a$3(r.x,r.y,i.x,i.y,u.x,u.y,h.x,h.y)&&s$5(h.prev,h,h.next)>=0)return !1;h=h.nextZ;}for(;v&&v.z>=p;){if(v!==e.prev&&v!==e.next&&a$3(r.x,r.y,i.x,i.y,u.x,u.y,v.x,v.y)&&s$5(v.prev,v,v.next)>=0)return !1;v=v.prevZ;}for(;h&&h.z<=c;){if(h!==e.prev&&h!==e.next&&a$3(r.x,r.y,i.x,i.y,u.x,u.y,h.x,h.y)&&s$5(h.prev,h,h.next)>=0)return !1;h=h.nextZ;}return !0}function u$3(e,n,t,x){const r=q.create(e,n,t);return x?(r.next=x.next,r.prev=x,x.next.prev=r,x.next=r):(r.prev=r,r.next=r),r}function o$6(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ);}function l$3(e){let n=e,t=e;do{(n.x<t.x||n.x===t.x&&n.y<t.y)&&(t=n),n=n.next;}while(n!==e);return t}function f$4(e,t,x,r,i,u){const o=new Array;for(let f=0,y=r.length;f<y;f++){const i=n$6(e,t,x,r[f]*u,f<y-1?r[f+1]*u:x*u,u,!1);i===i.next&&(i.steiner=!0),o.push(l$3(i));}o.sort(m$4);for(const n of o)i=y$1(n,i);return i}function y$1(e,n){const x=p$5(e,n);if(!x)return n;const r=j(x,e);return t$1(r,r.next),t$1(x,x.next)}function p$5(e,n){let t=n;const x=e.x,r=e.y;let i,u=-1/0;do{if(r<=t.y&&r>=t.next.y&&t.next.y!==t.y){const e=t.x+(r-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(e<=x&&e>u){if(u=e,e===x){if(r===t.y)return t;if(r===t.next.y)return t.next}i=t.x<t.next.x?t:t.next;}}t=t.next;}while(t!==n);if(!i)return null;if(x===u)return i.prev;const o=i,l=i.x,f=i.y;let y,p=1/0;for(t=i.next;t!==o;)x>=t.x&&t.x>=l&&x!==t.x&&a$3(r<f?x:u,r,l,f,r<f?u:x,r,t.x,t.y)&&(y=Math.abs(r-t.y)/(x-t.x),(y<p||y===p&&t.x>i.x)&&w$1(t,e)&&(i=t,p=y)),t=t.next;return i}function c$5(e,n,t,x){let r;for(;r!==e;r=r.next){if(r=r||e,null===r.z&&(r.z=z$1(r.x,r.y,n,t,x)),r.prev.next!==r||r.next.prev!==r)return r.prev.next=r,r.next.prev=r,c$5(e,n,t,x);r.prevZ=r.prev,r.nextZ=r.next;}return e.prevZ.nextZ=null,e.prevZ=null,v$1(e)}function v$1(e){let n,t=1;for(;;){let x,r=e;e=null,n=null;let i=0;for(;r;){i++,x=r;let u=0;for(;u<t&&x;u++)x=x.nextZ;let o=t;for(;u>0||o>0&&x;){let t;0===u?(t=x,x=x.nextZ,o--):0!==o&&x?r.z<=x.z?(t=r,r=r.nextZ,u--):(t=x,x=x.nextZ,o--):(t=r,r=r.nextZ,u--),n?n.nextZ=t:e=t,t.prevZ=n,n=t;}r=x;}if(n.nextZ=null,t*=2,i<2)return e}}function s$5(e,n,t){return (n.y-e.y)*(t.x-n.x)-(n.x-e.x)*(t.y-n.y)}function h$5(e,n,t,x){return !!(M$2(e,n)&&M$2(t,x)||M$2(e,x)&&M$2(t,n))||s$5(e,n,t)>0!=s$5(e,n,x)>0&&s$5(t,x,e)>0!=s$5(t,x,n)>0}function d$4(e,n){let t=e;do{if(t.index!==e.index&&t.next.index!==e.index&&t.index!==n.index&&t.next.index!==n.index&&h$5(t,t.next,e,n))return !0;t=t.next;}while(t!==e);return !1}function Z(e,n,t,x,r,i){let u=0;for(let o=x,l=r-i;o<r;o+=i)u+=(e[l+n*i]-e[o+n*i])*(e[o+1+n*i]+e[l+1+n*i]),l=o;return u}function a$3(e,n,t,x,r,i,u,o){return (r-u)*(n-o)-(e-u)*(i-o)>=0&&(e-u)*(x-o)-(t-u)*(n-o)>=0&&(t-u)*(i-o)-(r-u)*(x-o)>=0}function w$1(e,n){return s$5(e.prev,e,e.next)<0?s$5(e,n,e.next)>=0&&s$5(e,e.prev,n)>=0:s$5(e,n,e.prev)<0||s$5(e,e.next,n)<0}function z$1(e,n,t,x,r){return (e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-t)*r)|e<<8))|e<<4))|e<<2))|e<<1))|(n=1431655765&((n=858993459&((n=252645135&((n=16711935&((n=32767*(n-x)*r)|n<<8))|n<<4))|n<<2))|n<<1))<<1}function M$2(e,n){return e.x===n.x&&e.y===n.y}function m$4(e,n){return e.x-n.x}function b$2(e,n,t,x){let r=e;do{const i=r.prev,u=r.next.next;!M$2(i,u)&&h$5(i,r,r.next,u)&&w$1(i,u)&&w$1(u,i)&&(n.push(i.index/t+x),n.push(r.index/t+x),n.push(u.index/t+x),o$6(r),o$6(r.next),r=e=u),r=r.next;}while(r!==e);return r}function g$1(e,n,r,i,u,o,l){let f=e;do{let e=f.next.next;for(;e!==f.prev;){if(f.index!==e.index&&k$2(f,e)){let y=j(f,e);return f=t$1(f,f.next),y=t$1(y,y.next),x$3(f,n,r,i,u,o,l,0),void x$3(y,n,r,i,u,o,l,0)}e=e.next;}f=f.next;}while(f!==e)}function k$2(e,n){return e.next.index!==n.index&&e.prev.index!==n.index&&!d$4(e,n)&&w$1(e,n)&&w$1(n,e)&&A$1(e,n)}function A$1(e,n){let t=e,x=!1;const r=(e.x+n.x)/2,i=(e.y+n.y)/2;do{t.y>i!=t.next.y>i&&t.next.y!==t.y&&r<(t.next.x-t.x)*(i-t.y)/(t.next.y-t.y)+t.x&&(x=!x),t=t.next;}while(t!==e);return x}function j(e,n){const t=q.create(e.index,e.x,e.y),x=q.create(n.index,n.x,n.y),r=e.next,i=n.prev;return e.next=n,n.prev=e,t.next=r,r.prev=t,x.next=t,t.prev=x,i.next=x,x.prev=i,x}class q{constructor(){this.index=0,this.x=0,this.y=0,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1;}static create(e,n,t){const x=D<B$1.length?B$1[D++]:new q;return x.index=e,x.x=n,x.y=t,x.prev=null,x.next=null,x.z=null,x.prevZ=null,x.nextZ=null,x.steiner=!1,x}}const B$1=[],C=8096;let D=0;for(let E=0;E<C;E++)B$1.push(new q);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const i$5=1e-5,f$3=new e$4(0,0,0,1,0),c$4=new e$4(0,0,0,1,0);function u$2(t,e,n){let o=0;for(let r=1;r<n;r++){const n=t[2*(e+r-1)],s=t[2*(e+r-1)+1];o+=(t[2*(e+r)]-n)*(t[2*(e+r)+1]+s);}return o}function h$4(t,e,n,o,r){let s=0;const l=2;for(let i=n;i<o;i+=3){const n=(t[i]-r)*l,o=(t[i+1]-r)*l,f=(t[i+2]-r)*l;s+=Math.abs((e[n]-e[f])*(e[o+1]-e[n+1])-(e[n]-e[o])*(e[f+1]-e[n+1]));}return s}function a$2(t,e){const{coords:n,lengths:o,hasIndeterminateRingOrder:r}=e,s=0,f=t;if(r)return !1;let c=0;for(let a=0;a<o.length;){let t=a,e=o[a],r=u$2(n,c,e);const g=[];for(;++t<o.length;){const s=o[t],l=u$2(n,c+e,s);if(!(l>0))break;r+=l,g.push(c+e),e+=s;}const p=f.length;e$3(f,n,c,c+e,g,2,s);const m=h$4(f,n,p,f.length,s),d=Math.abs(r);if(Math.abs((m-d)/Math.max(1e-7,d))>i$5)return f.length=0,!1;a=t,c+=e;}return !0}function p$4(t){const{coords:n,lengths:o}=t,{buffer:r}=a$5(n,o);return r}function m$3(t,e,n){let o=0;for(let r=0;r<t.lengths.length;r++){const s=t.lengths[r];for(let r=0;r<s;r++){const s=t.coords[2*(r+o)],l=t.coords[2*(r+o)+1];if(s<e||s>n||l<e||l>n)return !0}o+=s;}return !1}function d$3(t,e){if(null==t)return null;if(!m$3(t,-128,a$4+128))return t;f$3.setPixelMargin(e),f$3.reset(i$7.Polygon);let n=0;for(let o=0;o<t.lengths.length;o++){const e=t.lengths[o];let r=t.coords[2*(0+n)],s=t.coords[2*(0+n)+1];f$3.moveTo(r,s);for(let o=1;o<e;o++)r=t.coords[2*(o+n)],s=t.coords[2*(o+n)+1],f$3.lineTo(r,s);f$3.close(),n+=e;}const l=f$3.result(!1);if(!l)return null;const i=[],c=[];for(const o of l){let t=0;for(const e of o)c.push(e.x),c.push(e.y),t++;i.push(t);}return new e$5(i,c)}function x$2(t,e){c$4.setPixelMargin(e);const n=c$4,r=-e,l=a$4+e;let i=[],f=!1;if(!t.nextPath())return null;let u=!0;for(;u;){t.seekPathStart();const e=[];if(!t.pathSize)return null;n.reset(i$7.LineString),t.nextPoint();let s=t.x,c=t.y;if(f)n.moveTo(s,c);else {if(s<r||s>l||c<r||c>l){f=!0;continue}e.push({x:s,y:c});}let h=!1;for(;t.nextPoint();)if(s=t.x,c=t.y,f)n.lineTo(s,c);else {if(s<r||s>l||c<r||c>l){h=!0;break}e.push({x:s,y:c});}if(h)f=!0;else {if(f){const t=n.resultWithStarts();if(t)for(const e of t)i.push(e);}else i.push({line:e,start:0});u=t.nextPath(),f=!1;}}return i=i.filter((t=>t.line.length>1)),0===i.length?null:i}f$3.setExtent(a$4),c$4.setExtent(a$4);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const n$5=96/72;let l$2 = class l{static executeEffects(t,e,l,c){const f=n$5,m=Q(t);let p=new s$6(e);for(const o of t){const t=A$2(o);t&&(p=t.execute(p,o,f,l,c,m));}return p}static applyEffects(n,l,c){if(!n)return l;const f=Q(n);let m,p=new s$6(a$6.fromJSONCIM(l));for(const t of n){const e=A$2(t);e&&(p=e.execute(p,t,1,null,c,f));}const u=[];let i=null;for(;m=p.next();)u.push(...t$2(m)),i=m.geometryType;return 0===u.length||null===i?null:"esriGeometryPolygon"===i?{rings:u}:{paths:u}}};

let n$4=null;function t(){return n$4}async function e$2(){n$4=await __vitePreload(() => import('./geometryEngineJSON-CoEI2ElB.js').then(n => n.g),true?__vite__mapDeps([0,1,2,3,4,5]):void 0,import.meta.url);}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function e$1(t){switch(t){case C$1.BYTE:case C$1.UNSIGNED_BYTE:return 1;case C$1.SHORT:case C$1.UNSIGNED_SHORT:case C$1.HALF_FLOAT:return 2;case C$1.FLOAT:case C$1.INT:case C$1.UNSIGNED_INT:return 4}}function o$5(t){const s=[],o=[],n=[];for(const i of t){const t=e$1(i.type)*i.count;switch(t%2||t%4||4){case 4:s.push(i);continue;case 2:o.push(i);continue;case 1:n.push(i);continue;default:throw new Error("Found unexpected dataType byte count")}}return s.push(...o),s.push(...n),s}let n$3 = class n{static fromVertexSpec(t,s){const{attributes:i,optionalAttributes:a}=t;let r,c,u;const p=[];for(const e in i){const t=i[e];"position"===t.pack?r={...t,name:e,offset:0}:"id"===t.pack?c={...t,name:e,offset:4}:"bitset"===e?u={...t,name:e,offset:7}:p.push({...t,name:e});}for(const e in a)if(!0===s[e]){const t=a[e];p.push({...t,name:e});}const h=o$5(p),f=[];let m=8,b=1;for(const o of h)f.push({...o,offset:m}),m+=e$1(o.type)*o.count,o.packAlternating&&(b=Math.max(o.packAlternating.count,b));const d=Uint32Array.BYTES_PER_ELEMENT,_=m%d;return new n(r,c,u,f,m+(_?d-_:0),b)}constructor(t,s,e,o,n,i){this.position=t,this.id=s,this.bitset=e,this.standardAttributes=o,this.stride=n,this.packVertexCount=i,o.push(e),this._attributes=[t,s,e,...o];}get attributeLayout(){if(!this._attributeLayout){const s=t$3(this._attributes),e=this._attributes.map((t=>({name:t.name,count:t.count,offset:t.offset,type:t.type,packPrecisionFactor:t.packPrecisionFactor,normalized:t.normalized??!1})));this._attributeLayout={attributes:e,hash:s,stride:this.stride};}return this._attributeLayout}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let i$4 = class i{static fromVertexSpec(t,s){const c=n$3.fromVertexSpec(t,s);return new i(c)}constructor(t){this._spec=t,this._packed=new Uint8Array(this._spec.stride*this._spec.packVertexCount),this._packedU32View=new Uint32Array(this._packed.buffer),this._dataView=new DataView(this._packed.buffer);}get attributeLayout(){return this._spec.attributeLayout}get stride(){return this._spec.stride}writeVertex(t,e,s,i,c,a){for(let p=0;p<this._spec.packVertexCount;p++){const t=p*this._spec.stride;this._packPosition(s,i,t),this._packId(e,t);const r=this._spec.bitset;if(a){if(r.packTessellation){const e=r.packTessellation(a,c);this._pack(e,r,t);}for(const e of this._spec.standardAttributes)if(null!=e.packTessellation){const s=e.packTessellation(a,c);this._pack(s,e,t);}else if(e.packAlternating?.packTessellation){const t=e.packAlternating.packTessellation(a,c);for(let s=0;s<this._spec.packVertexCount;s++){const i=t[s];this._pack(i,e,s*this._spec.stride);}}}}t.vertexWriteRegion(this._packedU32View);}pack(t,e){for(const s of this._spec.standardAttributes)if(s.pack&&"string"!=typeof s.pack){const i=s.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++)this._pack(i,s,t*this._spec.stride);}else if(s.packAlternating?.pack){const i=s.packAlternating.pack(t,e);for(let t=0;t<this._spec.packVertexCount;t++){const e=i[t];this._pack(e,s,t*this._spec.stride);}}}_packPosition(e,s,i){const{offset:c}=this._spec.position,a=this._spec.position.packPrecisionFactor??1,p=s$7(e*a,s*a);this._dataView.setUint32(i+c,p,!0);}_packId(t,e){const s=t*(this._spec.id.packPrecisionFactor??1),i=4278190080&this._dataView.getUint32(e+this._spec.id.offset,!0);this._dataView.setUint32(e+this._spec.id.offset,s|i,!0);}_pack(t,e,i){o$7(this._dataView,t,e,i);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function i$3(e){if(!e)return !1;for(const t of e)switch(t.effect.type){case"CIMGeometricEffectBuffer":case"CIMGeometricEffectOffset":case"CIMGeometricEffectDonut":return !0}return !1}let c$3 = class c{constructor(e,t,r,s){this._instanceId=e,this._evaluator=t,this._enabledOptionalAttributes=r,this._viewParams=s,this._evaluator.evaluator=e=>this.vertexSpec.createComputedParams(e);}get _vertexPack(){if(!this._cachedVertexPack){const e=i$4.fromVertexSpec(this.vertexSpec,this._enabledOptionalAttributes);this._evaluator.hasDynamicProperties||e.pack(this._evaluator.evaluatedMeshParams,this._viewParams),this._cachedVertexPack=e;}return this._cachedVertexPack}get evaluatedMeshParams(){return this._evaluator.evaluatedMeshParams}get hasEffects(){return !!this.evaluatedMeshParams.effects}get instanceId(){return this._instanceId}get attributeLayout(){return this._vertexPack.attributeLayout}setReferences(e){this._references=e;}getBoundsInfo(){return null}getTileInfo(){return this._viewParams.tileInfo}async loadDependencies(){i$3(this._evaluator.inputMeshParams.effects?.effectInfos)&&await e$2();}enqueueRequest(e,t,r){this._evaluator.hasDynamicProperties&&this._evaluator.enqueueRequest(e,t,r);}write(r,a,i,c,o){this.ensurePacked(a,i,c);const n=this.evaluatedMeshParams.effects;if(!n||0===n.length)return void this._write(r,i,void 0,o);const u=i.readGeometryForDisplay()?.clone();if(!u)return;const h=a$6.fromOptimizedCIM(u,i.geometryType),f=t();h.invertY();const m=r.id||"",l=l$2.executeEffects(n,h,m,f);let v;for(;v=l.next();)v.invertY(),this._write(r,i,v,o);}ensurePacked(e,t,r){if(!this._evaluator.hasDynamicProperties)return;const s=this._evaluator.evaluateMeshParams(e,t,r);this._vertexPack.pack(s,this._viewParams);}_writeVertex(e,t,r,s,a){const i=this.evaluatedMeshParams;this._vertexPack.writeVertex(e,t,r,s,i,a);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const o$4=100,n$2=has("featurelayer-fast-triangulation-enabled");let a$1 = class a extends c$3{async loadDependencies(){await Promise.all([super.loadDependencies(),i$8()]);}_write(e,t,r){const s=r?.asOptimized()??t.readGeometryForDisplay(),i=this._clip(s);i&&(e.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(e,t,i),e.recordEnd());}_clip(e){if(!e)return null;const r=this.hasEffects;return d$3(e,r?256:8)}_writeGeometry(e,t,i){const a=i.maxLength>o$4,c=[],l=this.createTesselationParams(t);if(!a&&n$2&&a$2(c,i))return void(c.length&&this._writeVertices(e,t,i.coords,l,c));const d=p$4(i);this._writeVertices(e,t,d,l);}_writeVertices(e,t,r,s,i){const o=t.getDisplayId(),n=e.vertexCount(),a=this.hasEffects;let c=0;if(i)for(const l of i){const t=r[2*l],i=r[2*l+1];a&&e.recordBounds(t,i,0,0),this._writeVertex(e,o,t,i,s),c++;}else for(let l=0;l<r.length;l+=2){const t=Math.round(r[l]),i=Math.round(r[l+1]);a&&e.recordBounds(t,i,0,0),this._writeVertex(e,o,t,i,s),c++;}e.indexEnsureSize(c);for(let l=0;l<c;l++)e.indexWrite(l+n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const r$1={createComputedParams:e=>e,optionalAttributes:{},attributes:{id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1},pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},inverseArea:{type:C$1.FLOAT,count:1,packTessellation:({inverseArea:e})=>e}}};let s$4 = class s extends a$1{constructor(){super(...arguments),this.vertexSpec=r$1;}createTesselationParams(e){return {inverseArea:1/e.readGeometryArea()}}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const i$2=()=>n$7.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.meshWriterUtils"),u$1=0,a=100;function m$2(r,e){return [!!r?.minScale&&e.scaleToZoom(r.minScale)||u$1,!!r?.maxScale&&e.scaleToZoom(r.maxScale)||a]}function f$2(r){return 1<<r}function l$1(r){let e=0;for(const[t,n]of r)n&&(e|=1<<t);return e}function g(t){let n;if(!t)return [0,0,0,0];if("string"==typeof t){const o=u$4.fromString(t);if(!o)return i$2().errorOnce(new s$8("mapview:mesh-processing","Unable to parse string into color",{color:t})),[0,0,0,0];n=o.toArray();}else n=t;const[o,s,c,u]=n;return [o*(u/255),s*(u/255),c*(u/255),u]}function h$3(r){switch(r){case"butt":case U.Butt:return e$6.BUTT;case"round":case U.Round:return e$6.ROUND;case"square":case U.Square:return e$6.SQUARE}}function p$3(r){switch(r){case"bevel":case w$2.Bevel:return n$8.BEVEL;case"miter":case w$2.Miter:return n$8.MITER;case"round":case w$2.Round:return n$8.ROUND}}function d$2(r,e){return Math.round(Math.min(Math.sqrt(r*e),255))}function S$2(r,e){return Math.round(r*e)/e}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const i$1={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:C$1.SHORT,count:2,packPrecisionFactor:rt,pack:({scaleInfo:t},{tileInfo:o})=>m$2(t,o)}},attributes:{id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1},pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>g(t)}}};let c$2 = class c extends a$1{constructor(){super(...arguments),this.vertexSpec=i$1;}createTesselationParams(t){return null}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const s$3={createComputedParams:t=>t,optionalAttributes:i$1.optionalAttributes,attributes:{...i$1.attributes,tlbr:{count:4,type:C$1.UNSIGNED_SHORT,pack:({sprite:e})=>{const{rect:r,width:i,height:s}=e,o=r.x+tt,a=r.y+tt;return [o,a,o+i,a+s]}},inverseRasterizationScale:{count:1,type:C$1.BYTE,packPrecisionFactor:16,pack:({sprite:t})=>1/t.rasterizationScale}}};let o$3 = class o extends c$2{constructor(){super(...arguments),this.vertexSpec=s$3;}_write(t,e,r){const i=r?.asOptimized()??e.readGeometryForDisplay(),s=this._clip(i);if(!s)return;const o=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,o),this._writeGeometry(t,e,s),t.recordEnd();}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function p$2(e){const{sprite:o,aspectRatio:s,scaleProportionally:r}=e,i=u$5(e.height),c=i>0?i:o.height;let a=i*s;return a<=0?a=o.width:r&&(a*=o.width/o.height),{width:a,height:c}}function n$1(t){const{applyRandomOffset:e,sampleAlphaOnly:s}=t;return l$1([[C$2,e],[q$1,s]])}const l={createComputedParams:t=>t,optionalAttributes:s$3.optionalAttributes,attributes:{...s$3.attributes,bitset:{count:1,type:C$1.UNSIGNED_BYTE,pack:n$1},width:{count:1,type:C$1.HALF_FLOAT,pack:t=>p$2(t).width},height:{count:1,type:C$1.HALF_FLOAT,pack:t=>p$2(t).height},offset:{count:2,type:C$1.HALF_FLOAT,pack:({offsetX:e,offsetY:o})=>[u$5(e),-u$5(o)]},scale:{count:2,type:C$1.UNSIGNED_BYTE,packPrecisionFactor:16,pack:({scaleX:t,scaleY:e})=>[t,e]},angle:{count:1,type:C$1.UNSIGNED_BYTE,pack:({angle:t})=>l$4(t)}}};let h$2 = class h extends o$3{constructor(){super(...arguments),this.vertexSpec=l;}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let d$1 = class d{constructor(){this.extrusionOffsetX=0,this.extrusionOffsetY=0,this.normalX=0,this.normalY=0,this.directionX=0,this.directionY=0,this.distance=0;}};const f$1={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:C$1.SHORT,count:2,packPrecisionFactor:rt,pack:({scaleInfo:t},{tileInfo:e})=>m$2(t,e)}},attributes:{id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},bitset:{type:C$1.UNSIGNED_BYTE,count:1},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:t})=>g(t)},offset:{type:C$1.BYTE,count:2,packPrecisionFactor:16,packTessellation:({extrusionOffsetX:t,extrusionOffsetY:e})=>[S$2(t,16),S$2(e,16)]},normal:{type:C$1.BYTE,count:2,packPrecisionFactor:16,packTessellation:({normalX:t,normalY:e})=>[S$2(t,16),S$2(e,16)]},halfWidth:{type:C$1.HALF_FLOAT,count:1,pack:({width:e})=>u$5(.5*e)},referenceHalfWidth:{type:C$1.HALF_FLOAT,count:1,pack:({referenceWidth:e})=>u$5(.5*e)}}};let _$2 = class _{constructor(){this.id=0,this.bitset=0,this.indexCount=0,this.vertexCount=0,this.vertexFrom=0,this.vertexBounds=0;}};const x$1=65535;let T$1 = class T extends c$3{constructor(t,e,s,i){super(t,e,s,i),this.vertexSpec=f$1,this._currentWrite=new _$2,this._tessellationOptions={halfWidth:0,pixelCoordRatio:1,offset:0,wrapDistance:x$1,textured:!1},this._tessParams=new d$1,this._initializeTessellator();}writeLineVertices(t,e,s){const i=this._getLines(e);null!=i&&this._writeVertices(t,s,i);}_initializeTessellator(){this._lineTessellator=new c$6(this._writeTesselatedVertex.bind(this),this._writeTriangle.bind(this),!0);}_write(t,s,i){const r=i??a$6.fromFeatureSetReaderCIM(s);r&&this._writeGeometry(t,s,r);}_writeGeometry(t,e,s,i){t.recordStart(this.instanceId,this.attributeLayout,i),this.writeLineVertices(t,s,e),t.recordEnd();}_getLines(t){return x$2(t,i$9(this.evaluatedMeshParams))}_writeVertices(e,s,r){const{_currentWrite:o,_tessellationOptions:n,evaluatedMeshParams:a}=this,{width:c,capType:m,joinType:u,miterLimit:p,hasSizeVV:d}=a,f=u$5(.5*c);n.halfWidth=f,n.capType=h$3(m),n.joinType=p$3(u),n.miterLimit=p;const _=!d;o.out=e,o.id=s.getDisplayId(),o.vertexCount=0,o.indexCount=0,o.vertexFrom=e.vertexCount(),o.vertexBounds=_&&f<R$1?0:1;for(const{line:t,start:i}of r)n.initialDistance=i%x$1,this._lineTessellator.tessellate(t,n,_);}_writeTesselatedVertex(t,e,s,i,r,o,n,a,c,h,l){const{out:m,id:u,vertexBounds:p}=this._currentWrite;return this.hasEffects&&m.recordBounds(t,e,p,p),this._tessParams.extrusionOffsetX=n,this._tessParams.extrusionOffsetY=a,this._tessParams.normalX=c,this._tessParams.normalY=h,this._tessParams.directionX=r,this._tessParams.directionY=o,this._tessParams.distance=l,this._writeVertex(m,u,t,e,this._tessParams),this._currentWrite.vertexFrom+this._currentWrite.vertexCount++}_writeTriangle(t,e,s){const{out:i}=this._currentWrite;i.indexEnsureSize(3),i.indexWrite(t),i.indexWrite(e),i.indexWrite(s),this._currentWrite.indexCount+=3;}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const p$1={createComputedParams:e=>e,optionalAttributes:f$1.optionalAttributes,attributes:{...f$1.attributes,bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:e=>0},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>g(e)}}},c$1={createComputedParams:e=>e,optionalAttributes:f$1.optionalAttributes,attributes:{...f$1.attributes,bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:e=>l$1([[B$2,!0]])},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>g(e)}}};let m$1 = class m extends T$1{constructor(){super(...arguments),this.vertexSpec=c$1;}};let h$1 = class h extends c$2{constructor(e,t,r,s){super(e,t,r,s),this.vertexSpec=p$1,this._lineMeshWriter=this._createOutlineWriter(e,t,r,s);}_createOutlineWriter(e,t,r,s){return new m$1(e,t,r,s)}_write(t,r,s){const i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);o&&(t.recordStart(this.instanceId,this.attributeLayout),this._writeGeometry(t,r,o),this._lineMeshWriter.writeLineVertices(t,a$6.fromOptimizedCIM(o,"esriGeometryPolyline"),r),t.recordEnd());}_clip(e){return e?d$3(e,i$9(this.evaluatedMeshParams)):null}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r);}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r);}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()]);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const d=l,h=c$1,f={createComputedParams:e=>e,optionalAttributes:d.optionalAttributes,attributes:{...d.attributes,bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:e=>n$1(e)},aux1:{count:1,type:C$1.HALF_FLOAT,pack:e=>p$2(e).width},aux2:{count:1,type:C$1.HALF_FLOAT,pack:e=>p$2(e).height},aux3:{count:2,type:C$1.HALF_FLOAT,pack:({offsetX:t,offsetY:r})=>[u$5(t),u$5(r)]},aux4:{count:2,type:C$1.UNSIGNED_BYTE,pack:({scaleX:e,scaleY:t})=>[e*S$3,t*S$3]}}},y={createComputedParams:e=>e,optionalAttributes:d.optionalAttributes,attributes:{...d.attributes,color:h.attributes.color,bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:e=>l$1([[B$2,!0]])},aux1:{count:1,type:C$1.HALF_FLOAT,pack:t=>u$5(.5*t.width)},aux2:{count:1,type:C$1.HALF_FLOAT,pack:t=>u$5(.5*t.referenceWidth)},aux3:{count:2,type:C$1.HALF_FLOAT,packTessellation:({extrusionOffsetX:e,extrusionOffsetY:t})=>[e,t]},aux4:{count:2,type:C$1.UNSIGNED_BYTE,packTessellation:({normalX:e,normalY:t})=>[e*S$3+w$3,t*S$3+w$3]}}};class x extends m$1{constructor(){super(...arguments),this.vertexSpec=y;}}let _$1 = class _ extends h$1{constructor(){super(...arguments),this.vertexSpec=f;}_createOutlineWriter(e,t,r,s){return new x(e,t,r,s)}_write(e,r,s){const i=s?.asOptimized()??r.readGeometryForDisplay(),o=this._clip(i);if(!o)return;const a=this.evaluatedMeshParams.sprite?.textureBinding;e.recordStart(this.instanceId,this.attributeLayout,a),this._writeGeometry(e,r,o),this._lineMeshWriter.writeLineVertices(e,a$6.fromOptimizedCIM(o,"esriGeometryPolyline"),r),e.recordEnd();}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r);}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r);}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()]);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const n={optionalAttributes:s$3.optionalAttributes,createComputedParams:e=>e,attributes:{...s$3.attributes,...p$1.attributes}},o$2={optionalAttributes:s$3.optionalAttributes,createComputedParams:e=>e,attributes:{...s$3.attributes,...c$1.attributes}};class u extends m$1{constructor(){super(...arguments),this.vertexSpec=o$2;}}class c extends h$1{constructor(){super(...arguments),this.vertexSpec=n;}_createOutlineWriter(e,t,r,s){return new u(e,t,r,s)}_write(t,r,s){const i=s?.asOptimized()??r.readGeometryForDisplay(),a=this._clip(i);if(!a)return;const n=this.evaluatedMeshParams.sprite?.textureBinding;t.recordStart(this.instanceId,this.attributeLayout,n),this._writeGeometry(t,r,a),this._lineMeshWriter.writeLineVertices(t,a$6.fromOptimizedCIM(a,"esriGeometryPolyline"),r),t.recordEnd();}ensurePacked(e,t,r){super.ensurePacked(e,t,r),this._lineMeshWriter.ensurePacked(e,t,r);}enqueueRequest(e,t,r){super.enqueueRequest(e,t,r),this._lineMeshWriter.enqueueRequest(e,t,r);}async loadDependencies(){await Promise.all([super.loadDependencies(),this._lineMeshWriter.loadDependencies()]);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const r={createComputedParams:t=>t,optionalAttributes:{},attributes:{pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1},offset:{type:C$1.BYTE,count:2,packAlternating:{count:4,pack:()=>[[-1,-1],[1,-1],[-1,1],[1,1]]}}}};class i extends c$3{constructor(){super(...arguments),this.vertexSpec=r;}_write(t,e){t.recordStart(this.instanceId,this.attributeLayout);const r=e.getDisplayId();if("esriGeometryPoint"===e.geometryType){const i=e.readXForDisplay(),o=e.readYForDisplay();this._writeQuad(t,r,i,o);}else if("esriGeometryMultipoint"===e.geometryType){const i=e.readGeometryForDisplay();i?.forEachVertex(((e,i)=>{e>=0&&e<=512&&i>=0&&i<=512&&this._writeQuad(t,r,e,i);}));}t.recordEnd();}_writeQuad(t,e,r,i){const o=t.vertexCount();this._writeVertex(t,e,r,i),t.indexWrite(o+0),t.indexWrite(o+1),t.indexWrite(o+2),t.indexWrite(o+1),t.indexWrite(o+3),t.indexWrite(o+2);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
class e{static getPlacement(e,r,n,s,c,o){const a=g$2(n);if(!a)return null;-1===r&&e.invertY();return a.execute(e,n,s,c,o)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const s$2=96;let o$1 = class o{constructor(o){const{offsetX:f,offsetY:i,postAngle:e,fontSize:n,scaleFactor:h,transforms:r}=o;if(this.offsetX=f,this.offsetY=i,this.postAngle=e,this.fontSize=Math.min(n,s$2),this.transforms=r,r&&r.infos.length>1){const o=z$2(n,e,!1,f,i,r);this.fontSize=Math.min(o.size,s$2),this.postAngle=o.rotation,this.offsetX=o.offsetX,this.offsetY=o.offsetY;}h&&(this.fontSize*=h,this.offsetX*=h,this.offsetY*=h);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const S$1=28,b$1=[4,4],k$1=[16,4],T={topLeft:k$1,topRight:k$1,bottomLeft:k$1,bottomRight:k$1},B=[4,2],R=[4,6],w={topLeft:B,topRight:B,bottomLeft:R,bottomRight:R},M$1={topLeft:B,topRight:R,bottomLeft:B,bottomRight:R},z={topLeft:R,topRight:R,bottomLeft:b$1,bottomRight:b$1},L={topLeft:b$1,topRight:b$1,bottomLeft:R,bottomRight:R},I$1={topLeft:R,topRight:b$1,bottomLeft:R,bottomRight:b$1},E={topLeft:b$1,topRight:R,bottomLeft:b$1,bottomRight:R},G={createComputedParams:t=>t,optionalAttributes:{zoomRange:{type:C$1.UNSIGNED_SHORT,count:2,packPrecisionFactor:rt,packTessellation:({minZoom:t,maxZoom:e})=>[t||0,e||S$1]},clipAngle:{type:C$1.UNSIGNED_BYTE,count:1,packTessellation:({clipAngle:t})=>A(t||0)},referenceSymbol:{type:C$1.BYTE,count:4,packPrecisionFactor:1,packTessellation:(t,o)=>{if(!t.referenceBounds)return [0,0,0,0];const r=s$9(o.horizontalAlignment),n=i$a(o.verticalAlignment),{offsetX:a,offsetY:c,size:l}=t.referenceBounds;return [u$5(a),-u$5(c),u$5(l),r+1<<2|n+1]}}},attributes:{pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1,packTessellation:({isBackground:t,mapAligned:e})=>l$1([[F,t],[H,!!e]])},offset:{type:C$1.SHORT,count:2,packPrecisionFactor:8,packAlternating:{count:4,packTessellation:({offsets:t})=>{const{bottomLeft:e,bottomRight:o,topLeft:r,topRight:i}=t;return [r,i,e,o]}}},textureUV:{type:C$1.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,packTessellation:({texcoords:t})=>{const{bottomLeft:e,bottomRight:o,topLeft:r,topRight:i}=t;return [r,i,e,o]}}},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,packTessellation:({color:t})=>t},fontSize:{type:C$1.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t})=>u$5(t)},referenceSize:{type:C$1.UNSIGNED_BYTE,count:1,packPrecisionFactor:4,packTessellation:({fontSize:t},{referenceSize:o})=>u$5(o??t)},haloColor:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({haloColor:t})=>g(t)},haloFontSize:{type:C$1.UNSIGNED_SHORT,count:1,packPrecisionFactor:4,pack:({haloFontSize:t})=>u$5(t)}}};class N extends c$3{constructor(){super(...arguments),this.vertexSpec=G,this._textMeshParamsPropsInitialized=!1;}ensurePacked(t,e,o){super.ensurePacked(t,e,o),this._textMeshParamsPropsInitialized&&!this._evaluator.hasDynamicProperties||(this._textMeshTransformProps=new o$1(this.evaluatedMeshParams),this._textMeshParamsPropsInitialized=!0);}_write(t,e,o){const r=this._getShaping();if(!r)return;const i=e.getDisplayId();if(null!=this.evaluatedMeshParams.placement)return this._writePlacedTextMarkers(t,e,r,o);if(o?.nextPath())return o.nextPoint(),this._writeGlyphs(t,i,o.x,o.y,r,0);if("esriGeometryPolygon"===e.geometryType){const o=e.readCentroidForDisplay();if(!o)return;const[s,n]=o.coords;return this._writeGlyphs(t,i,s,n,r,0)}if("esriGeometryMultipoint"===e.geometryType){const o=e.readGeometryForDisplay();return void o?.forEachVertex(((e,o)=>this._writeGlyphs(t,i,e,o,r,0)))}const s=e.readXForDisplay(),n=e.readYForDisplay();return this._writeGlyphs(t,i,s,n,r,0)}_writePlacedTextMarkers(t$1,i,s,n){const a=n??a$6.fromFeatureSetReaderCIM(i);if(!a)return;const c=-1,l=e.getPlacement(a,c,this.evaluatedMeshParams.placement,u$5(1),t$1.id,t());if(!l)return;const f=i.getDisplayId();let h=l.next();for(;null!=h;){const e=h.tx,o=-h.ty,r=-h.getAngle();this._writeGlyphs(t$1,f,e,o,s,r),h=l.next();}}_getShaping(o){const r=this._textMeshTransformProps,i=this.evaluatedMeshParams;if(!i.glyphs?.glyphs.length)return null;const s=Math.round(u$5(r.fontSize)),n=u$5(r.offsetX),p=u$5(r.offsetY),m=e$7(u$5(i.lineWidth),zt,Bt),d=V*e$7(i.lineHeightRatio,.25,4);return O(i.glyphs,{scale:s/A$3,angle:r.postAngle,xOffset:n,yOffset:p,horizontalAlignment:i.horizontalAlignment,verticalAlignment:o||i.verticalAlignment,maxLineWidth:m,lineHeight:d,decoration:i.decoration,borderLineSizePx:u$5(i.boxBorderLineSize),hasBackground:!!i.boxBackgroundColor,useCIMAngleBehavior:i.useCIMAngleBehavior})}_writeGlyphs(t,o,r,i,s,n,a,c){const l=this.evaluatedMeshParams,f=this._textMeshTransformProps,h=f.fontSize,p=u$5(f.offsetX),u=u$5(f.offsetY),[g$1,x]=m$2(l.scaleInfo,this.getTileInfo());0!==n&&s.setRotation(n);const y=s.bounds,_=r+y.x+p,P=i+y.y-u,S=2*(l.minPixelBuffer?l.minPixelBuffer/h:1),b=Math.max(y.width,y.height)*S;s.textBox&&(t.recordStart(this.instanceId,this.attributeLayout,s.glyphs[0].textureBinding),t.recordBounds(_,P,b,b),this._writeTextBox(t,o,r,i,s.textBox,a,c),t.recordEnd());for(const e of s.glyphs){t.recordStart(this.instanceId,this.attributeLayout,e.textureBinding),t.recordBounds(_,P,b,b);const{texcoords:s,offsets:n}=e;this._writeQuad(t,o,r,i,{texcoords:s,offsets:n,fontSize:h,color:g(l.color),isBackground:!1,referenceBounds:a,minZoom:g$1,maxZoom:x,...c}),t.recordEnd();}0!==n&&s.setRotation(-n);}_writeTextBox(t,e,o,r,i,s,n){const a=this.evaluatedMeshParams,{fontSize:c}=this._textMeshTransformProps,{boxBackgroundColor:l,boxBorderLineColor:f}=a,h={isBackground:!0,fontSize:c,referenceBounds:s,...n};l&&(this._writeQuad(t,e,o,r,{texcoords:T,offsets:i.main,color:g(l),...h}),f||(this._writeQuad(t,e,o,r,{texcoords:z,offsets:i.top,color:g(l),...h}),this._writeQuad(t,e,o,r,{texcoords:L,offsets:i.bot,color:g(l),...h}),this._writeQuad(t,e,o,r,{texcoords:I$1,offsets:i.left,color:g(l),...h}),this._writeQuad(t,e,o,r,{texcoords:E,offsets:i.right,color:g(l),...h}))),f&&(this._writeQuad(t,e,o,r,{texcoords:w,offsets:i.top,color:g(f),...h}),this._writeQuad(t,e,o,r,{texcoords:w,offsets:i.bot,color:g(f),...h}),this._writeQuad(t,e,o,r,{texcoords:M$1,offsets:i.left,color:g(f),...h}),this._writeQuad(t,e,o,r,{texcoords:M$1,offsets:i.right,color:g(f),...h}));}_writeQuad(t,e,o,r,i){const s=t.vertexCount();this._writeVertex(t,e,o,r,i),t.indexWrite(s+0),t.indexWrite(s+1),t.indexWrite(s+2),t.indexWrite(s+1),t.indexWrite(s+3),t.indexWrite(s+2);}}const A=t=>Math.round(t*(254/360));

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const p={createComputedParams:t=>t,optionalAttributes:f$1.optionalAttributes,attributes:{...f$1.attributes,bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:({shouldSampleAlphaOnly:t,shouldScaleDash:e,isSDF:s})=>l$1([[q$1,t],[D$1,e],[E$1,s]])},tlbr:{type:C$1.UNSIGNED_SHORT,count:4,pack:({sprite:t})=>{const{rect:r,width:s,height:i}=t,o=r.x+tt,n=r.y+tt;return [o,n,o+s,n+i]}},accumulatedDistance:{type:C$1.UNSIGNED_SHORT,count:1,packTessellation:({distance:t})=>t},segmentDirection:{type:C$1.BYTE,count:2,packPrecisionFactor:16,packTessellation:({directionX:t,directionY:e})=>[t,e]}}};class m extends T$1{constructor(t,e,r,s){super(t,e,r,s),this.vertexSpec=p,this._tessellationOptions.textured=!0;}_write(e,r,s){const i=s??a$6.fromFeatureSetReaderCIM(r);if(!i)return;const{sprite:o}=this.evaluatedMeshParams;this._writeGeometry(e,r,i,o?.textureBinding);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let s$1 = class s{static from(t){return "width"in t?this.fromSimpleMeshParams(t):this.fromComplexMeshParams(t)}static fromSimpleMeshParams(e){const i=new s(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects),{type:o,width:h,height:r,angle:n,alignment:a,outlineSize:c,referenceSize:l,sprite:m,overrideOutlineColor:f}=e;i.rawWidth=u$5(h),i.rawHeight=u$5(r),i.angle=n,i.alignment=a,i.outlineSize=u$5(c),i.referenceSize=u$5(l),i.overrideOutlineColor=f,i.offsetX=u$5(e.offsetX),i.offsetY=u$5(e.offsetY),"simple"!==o||m.sdf||(i.rawWidth=m.width,i.rawHeight=m.height);const d=2;return i.sizeRatio=m.sdf?d:1,i._computeSize(e,!1),i}static fromComplexMeshParams(e){const o=new s(e.sprite,e.color,e.outlineColor,e.minPixelBuffer,e.placement,e.scaleInfo,e.effects);let{alignment:h,transforms:r,size:n,scaleX:a,anchorX:c,anchorY:l,angle:m,colorLocked:f,frameHeight:d,widthRatio:u,offsetX:p,offsetY:g,outlineSize:x,referenceSize:w,scaleFactor:z,sizeRatio:S,isAbsoluteAnchorPoint:X,rotateClockwise:Y,scaleSymbolsProportionally:H,sprite:M}=e;if(r&&r.infos.length>0){const t=z$2(n,m,Y,p,g,r);n=t.size,m=t.rotation,p=t.offsetX,g=t.offsetY,Y=!1;}z&&(n*=z,p*=z,g*=z);const C=a*(M.width/M.height);o.alignment=h,o.rawHeight=u$5(n),o.rawWidth=o.rawHeight*C,o.referenceSize=u$5(w),o.sizeRatio=S,o.angle=m,o.rotateClockwise=Y,o.anchorX=c,o.anchorY=l,o.offsetX=u$5(p),o.offsetY=u$5(g),X&&n&&(M.sdf?o.anchorX=c/(n*u):o.anchorX=c/(n*C),o.anchorY=l/n);const W=H&&d?n/d:1;return o.outlineSize=0===x||isNaN(x)?0:u$5(x)*W,o.scaleSymbolsProportionally=H,o.colorLocked=f,o._computeSize(e,!0),o}constructor(t,i,o,s,h,r,n){this.sprite=t,this.color=i,this.outlineColor=o,this.minPixelBuffer=s,this.placement=h,this.scaleInfo=r,this.effects=n,this.rawWidth=0,this.rawHeight=0,this.angle=0,this.outlineSize=0,this.referenceSize=0,this.sizeRatio=1,this.alignment=i$b.SCREEN,this.scaleSymbolsProportionally=!1,this.overrideOutlineColor=!1,this.colorLocked=!1,this.anchorX=0,this.anchorY=0,this.computedWidth=0,this.computedHeight=0,this.texXmin=0,this.texYmin=0,this.texXmax=0,this.texYmax=0,this.offsetX=0,this.offsetY=0,this.rotateClockwise=!0;}get boundsInfo(){return {size:Math.max(this.computedHeight,this.computedWidth),offsetX:this.offsetX,offsetY:this.offsetY}}_computeSize(t,e){const{sprite:i,hasSizeVV:s}=t,h=!!i.sdf,{rawWidth:r,rawHeight:n,sizeRatio:a,outlineSize:c}=this,l=r*a,m=n*a;if(h&&!s){const t=e&&r>n?l:r,i=n,o=c+2*1;this.computedWidth=Math.min(t+o,l),this.computedHeight=Math.min(i+o,m);}else this.computedWidth=l,this.computedHeight=m;const f=h?Math.max(i.width,i.height)/Math.max(l,m):1,d=.5*(l-this.computedWidth)*f,u=.5*(m-this.computedHeight)*f,p=i.rect.x+tt+d,g=i.rect.y+tt+u,x=p+i.width-2*d,w=g+i.height-2*u;this.texXmin=Math.floor(p),this.texYmin=Math.floor(g),this.texXmax=Math.ceil(x),this.texYmax=Math.ceil(w),this.computedWidth*=(this.texXmax-this.texXmin)/(x-p),this.computedHeight*=(this.texYmax-this.texYmin)/(w-g),this.anchorX*=l/this.computedWidth,this.anchorY*=m/this.computedHeight;}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const M=3.14159265359/180,k=128/Math.PI;function b(e,t){return e%=t,Math.abs(e>=0?e:e+t)}function S(e){return b(e*k,256)}function I(e,i,a,n,c=!1){const m=n$9(),l=c?1:-1;return a$7(m),(i||a)&&i$c(m,m,[i,-a]),n&&s$a(m,m,l*M*-n),m}const _={createComputedParams:e=>s$1.from(e),optionalAttributes:{zoomRange:{type:C$1.SHORT,count:2,packPrecisionFactor:rt,pack:({scaleInfo:e},{tileInfo:t})=>m$2(e,t)}},attributes:{pos:{type:C$1.SHORT,count:2,pack:"position",packPrecisionFactor:10},id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:({sprite:e,alignment:t,scaleSymbolsProportionally:r,overrideOutlineColor:o,colorLocked:s})=>{let i=0;return e.sdf&&(i|=f$2(o$8.bitset.isSDF)),t===i$b.MAP&&(i|=f$2(o$8.bitset.isMapAligned)),r&&(i|=f$2(o$8.bitset.scaleSymbolsProportionally)),o&&(i|=f$2(o$8.bitset.overrideOutlineColor)),s&&(i|=f$2(o$8.bitset.colorLocked)),i}},offset:{type:C$1.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({angle:e,computedWidth:t,computedHeight:r,anchorX:o,anchorY:s,offsetX:a,offsetY:n,rotateClockwise:c})=>{const m=I(0,a,n,-e,c),l=-(.5+o)*t,u=-(.5-s)*r,d=[l,u],p=[l+t,u],h=[l,u+r],f=[l+t,u+r];return S$4(d,d,m),S$4(p,p,m),S$4(h,h,m),S$4(f,f,m),[d,p,h,f]}}},textureUV:{type:C$1.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:({texXmax:e,texXmin:t,texYmax:r,texYmin:o})=>[[t,o],[e,o],[t,r],[e,r]]}},color:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({color:e})=>g(e)},outlineColor:{type:C$1.UNSIGNED_BYTE,count:4,normalized:!0,pack:({outlineColor:e})=>g(e)},sizing:{type:C$1.UNSIGNED_BYTE,count:4,pack:({rawWidth:e,rawHeight:t,outlineSize:r,referenceSize:o})=>{const s=Math.max(e,t);return [d$2(s,128),d$2(r,128),d$2(o,128),0]}},placementAngle:{type:C$1.UNSIGNED_BYTE,count:1,packTessellation:({placementAngle:e})=>S(e)},sizeRatio:{type:C$1.UNSIGNED_SHORT,count:1,packPrecisionFactor:64,pack:({sizeRatio:e})=>e}}};class v extends c$3{constructor(){super(...arguments),this.vertexSpec=_;}getBoundsInfo(){return this.evaluatedMeshParams.boundsInfo}_write(e,t,r){const o=this.evaluatedMeshParams.sprite?.textureBinding,s=t.getDisplayId();e.recordStart(this.instanceId,this.attributeLayout,o);const i=this.evaluatedMeshParams.minPixelBuffer,a=Math.max(this.evaluatedMeshParams.computedWidth,i),c=Math.max(this.evaluatedMeshParams.computedHeight,i),m=this.evaluatedMeshParams.offsetX,l=-this.evaluatedMeshParams.offsetY;if(null!=this.evaluatedMeshParams.placement)this._writePlacedMarkers(e,t,r,a,c);else if(r?.nextPath()){r.nextPoint();const t=r.x,o=r.y;e.recordBounds(t+m,o+l,a,c),this._writeQuad(e,s,t,o);}else if("esriGeometryPolygon"===t.geometryType){const r=t.readCentroidForDisplay();if(!r)return;const[o,i]=r.coords;e.recordBounds(o+m,i+l,a,c),this._writeQuad(e,s,o,i);}else if("esriGeometryPoint"===t.geometryType){const r=t.readXForDisplay(),o=t.readYForDisplay();e.recordBounds(r+m,o+l,a,c),this._writeQuad(e,s,r,o);}else {const r=t.readGeometryForDisplay();r?.forEachVertex(((t,r)=>{e.recordBounds(t+m,r+l,a,c),Math.abs(t)>t$4||Math.abs(r)>t$4||this._writeQuad(e,s,t,r);}));}e.recordEnd();}_writePlacedMarkers(t$1,r,o,s,i){const c=o??a$6.fromFeatureSetReaderCIM(r)?.clone();if(!c)return;const l=-1,u=e.getPlacement(c,l,this.evaluatedMeshParams.placement,u$5(1),t$1.id,t());if(!u)return;const d=r.getDisplayId();let p=u.next();const h=this.evaluatedMeshParams.offsetX,f=-this.evaluatedMeshParams.offsetY;for(;null!=p;){const e=p.tx,r=-p.ty;if(Math.abs(e)>t$4||Math.abs(r)>t$4){p=u.next();continue}const o=-p.getAngle();t$1.recordBounds(e+h,r+f,s,i),this._writeQuad(t$1,d,e,r,o),p=u.next();}}_writeQuad(e,t,r,o,s){const i=e.vertexCount(),a=null==s?null:{placementAngle:s};this._writeVertex(e,t,r,o,a),e.indexWrite(i+0),e.indexWrite(i+1),e.indexWrite(i+2),e.indexWrite(i+1),e.indexWrite(i+3),e.indexWrite(i+2);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const o={createComputedParams:e=>e,optionalAttributes:{},attributes:{pos:{type:C$1.SHORT,count:2,packPrecisionFactor:10,pack:"position"},id:{type:C$1.UNSIGNED_BYTE,count:3,pack:"id"},bitset:{type:C$1.UNSIGNED_BYTE,count:1,pack:e=>0},offset:{type:C$1.SHORT,count:2,packPrecisionFactor:16,packAlternating:{count:4,pack:({size:t})=>{const r=u$5(t),i=-r/2,o=-r/2;return [[i,o],[i+r,o],[i,o+r],[i+r,o+r]]}}},texCoords:{type:C$1.SHORT,count:2,packPrecisionFactor:4,packAlternating:{count:4,pack:()=>[[0,1],[1,1],[0,0],[1,0]]}},size:{type:C$1.UNSIGNED_BYTE,count:2,pack:({size:e})=>[e,e]},referenceSize:{type:C$1.UNSIGNED_BYTE,count:1,pack:({size:t})=>u$5(t)},zoomRange:{type:C$1.UNSIGNED_BYTE,count:2,pack:({scaleInfo:e},{tileInfo:r})=>m$2(e,r)}}};class s extends c$3{constructor(){super(...arguments),this.vertexSpec=o;}_write(t,r){const i=r.getDisplayId(),o=this.evaluatedMeshParams.minPixelBuffer,s=Math.max(u$5(this.evaluatedMeshParams.size),o);let c,n;if("esriGeometryPoint"===r.geometryType)c=r.readXForDisplay(),n=r.readYForDisplay();else {const e=r.readCentroidForDisplay();if(!e)return;c=e?.coords[0],n=e?.coords[1];}t.recordStart(this.instanceId,this.attributeLayout),t.recordBounds(c,n,s,s);const a=t.vertexCount();this._writeVertex(t,i,c,n),t.indexWrite(a+0),t.indexWrite(a+1),t.indexWrite(a+2),t.indexWrite(a+1),t.indexWrite(a+3),t.indexWrite(a+2),t.recordEnd();}}

export { N, S$1 as S, T$1 as T, _$1 as _, m as a, h$2 as b, c, s$4 as d, c$2 as e, g, h$1 as h, i, l$2 as l, m$2 as m, o$3 as o, s, v };
