import { J as h$5, K as g$3, L as b$6, P as P$1, M as j, N as tt$1, R as G, T as se, U as Bn, V as j$1, X as ee, Y as H, _ as kn, a0 as te, a1 as m$a, a2 as C$1, a3 as S$3, a4 as w$4, a5 as d$3, a6 as F$3, a7 as U, a8 as K, a9 as S$4, aa as P$2, ab as nt, ac as ln, ad as q, ae as q$1, e as e$2, af as x$4, ag as _$3, ah as C$3, ai as H$1, aj as z$3, ak as S$5, al as R$2, am as v$3, an as xt, ao as h$7, ap as Bt, aq as i$4, ar as t$9, as as Wn, at as tn, au as _$4, av as I$1, aw as Xt, ax as Un, ay as vn, az as j$2, aA as A$1, aB as t$a, aC as n$8, aD as Ht, aE as Ct, aF as Y$2, aG as G$2, aH as P$4, aI as O$1, aJ as Dt, aK as Nt, F as F$5, H as H$2, aL as f$8, aM as h$8, aN as m$b, aO as p$b, aP as f$9, aQ as l$4, aR as p$c, aS as B$1, aT as q$2, aU as bn, aV as Sn, aW as k, aX as Zt, aY as T$3, aZ as D$2, D as D$3, E as E$3, q as q$3, a_ as q$4, a$ as z$4, b0 as u$7, b1 as r$3, b2 as c$7, b3 as St, b4 as o$6, b5 as sn, b6 as h$9, b7 as yt, b8 as g$4, p as o$7, b9 as a$4, b as ee$1, d as d$5 } from './UpdateTracking2D-tfVHyc-s.js';
import { bd as e, ps as t$5, l2 as t$8, s as s$4, fI as r$2, G as n$7, aC as l$5, lK as t$b, jz as o$8, db as u$8, bt as W, oB as m$c, pk as t$c, O as O$2, n1 as _$5, fy as d$6 } from './main-CGBWc59Z.js';
import { a as a$3, J, K as K$1, c as rt, U as U$2, p as i$5 } from './definitions-BdwlvHBE.js';
import { E, S as S$2, f as f$7, p as p$a, y as y$3, d as h$6, M as M$1, e as c$6, g as d$4, w as w$5, L as L$1 } from './Container-C6eOHu3y.js';
import { C as C$2, F as F$4, L, D as D$1, B, E as E$2, U as U$1, _ as _$2, G as G$1, P as P$3, O, I } from './enums-CwcDCDam.js';
import { c as c$4, s as s$3, i as i$3, E as E$1 } from './Program-DgbP8X_l.js';
import { o as o$4 } from './ProgramTemplate-B06R9gvz.js';
import { t as t$6 } from './VertexElementDescriptor-Bcj0303n.js';
import { a as t$7 } from './LabelMetric-DeEwVo6w.js';
import { e as e$1, c as c$5 } from './Texture-C4ft8TUm.js';
import { o as o$5 } from './constants-BNnV1ogR.js';
import { c as n$9 } from './WGLContainer-DmNNClwO.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let t$4 = class t{constructor(){this.drawPhase=E.MAP|E.HITTEST|E.HIGHLIGHT|E.DEBUG;}startup(){}shutdown(s){}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let o$3 = class o extends t$4{constructor(){super(...arguments),this.overrideStencilRef=null,this.symbologyPlane=S$2.FILL,this.postProcessingEnabled=!1;}postProcess(s,e){}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let z$2 = class z extends b$6{};e([h$5(0,C$1)],z$2.prototype,"pos",void 0);let F$2 = class F extends F$3{};let R$1 = class R extends P$1{};e([g$3(j$1)],R$1.prototype,"dotSize",void 0);let b$5 = class b extends P$1{};e([g$3(S$3)],b$5.prototype,"locations",void 0),e([g$3(j$1)],b$5.prototype,"pixelRatio",void 0),e([g$3(j$1)],b$5.prototype,"tileZoomFactor",void 0);const P=1e-6;class C extends j{vertex(t){const o=new tt$1(1,0,0,0,-1,0,0,1,1).multiply(new G(t.pos.xy.divide(a$3),1)),i=se(this.draw.locations,o.xy),s=Bn(this.instance.dotSize.divide(2),new j$1(1));let r=new j$1(0);r=r.add(ee(i.a,new j$1(P)).multiply(2));let d=s.add(this.instance.dotSize);const n=this.view.displayViewScreenMat3.multiply(new G(t.pos.add(.5),1)),a=new H(n.xy,r,1),l=this.instance.dotSize.divide(d),h=new j$1(-1).divide(s.divide(d));return d=d.multiply(this.draw.pixelRatio.multiply(this.draw.tileZoomFactor)),{glPosition:a,glPointSize:d,color:i,ratio:l,invEdgeRatio:h}}fragment(t){const o=kn(t.glPointCoord.subtract(.5)).multiply(2),e=te(new j$1(0),new j$1(1),t.invEdgeRatio.multiply(o.subtract(t.ratio)).add(1)),i=new w$4;return i.glFragColor=t.color.multiply(e),i}}e([g$3(R$1)],C.prototype,"instance",void 0),e([g$3(b$5)],C.prototype,"draw",void 0),e([g$3(d$3)],C.prototype,"view",void 0),e([t$5(0,m$a(z$2))],C.prototype,"vertex",null),e([t$5(0,m$a(F$2))],C.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
class D extends S$4{}e([h$5(3,j$1)],D.prototype,"inverseArea",void 0);let V$2 = class V extends P$1{};e([g$3(U.ofType(H,2))],V$2.prototype,"isActive",void 0),e([g$3(U.ofType(H,8))],V$2.prototype,"colors",void 0),e([g$3(j$1)],V$2.prototype,"dotValue",void 0);let F$1 = class F extends P$1{};e([g$3(S$3)],F$1.prototype,"dotTexture0",void 0),e([g$3(S$3)],F$1.prototype,"dotTexture1",void 0),e([g$3(j$1)],F$1.prototype,"tileZoomFactor",void 0),e([g$3(j$1)],F$1.prototype,"pixelRatio",void 0),e([g$3(j$1)],F$1.prototype,"tileDotsOverArea",void 0);let _$1 = class _ extends P$2{_dotThreshold(t,e,o){return t.divide(e).divide(o)}vertex(t){const e=new tt$1(2/a$3,0,0,0,-2/a$3,0,-1,1,1).multiply(new G(t.pos,1)),s=this.clip(t.id),i=new H(e.xy,s,1),r=this.storage.getVVData(t.id).multiply(this.instance.isActive.get(0)).multiply(t.inverseArea),l=this.storage.getDataDrivenData0(t.id).multiply(this.instance.isActive.get(1)).multiply(t.inverseArea),d=this.draw.tileZoomFactor.multiply(a$3).divide(this.draw.pixelRatio),a=this._dotThreshold(r,this.instance.dotValue,this.draw.tileDotsOverArea),n=this._dotThreshold(l,this.instance.dotValue,this.draw.tileDotsOverArea),u=t.pos.add(.5).divide(d);return {glPosition:i,color:new H(0,0,0,0),textureCoords:u,thresholds0:a,thresholds1:n}}fragment(t){const e=new w$4,o=se(this.draw.dotTexture0,t.textureCoords),s=se(this.draw.dotTexture1,t.textureCoords),i=t.thresholds0.subtract(o),r=t.thresholds1.subtract(s);let l;const a=nt.fromColumns(this.instance.colors[0],this.instance.colors[1],this.instance.colors[2],this.instance.colors[3]),n=nt.fromColumns(this.instance.colors[4],this.instance.colors[5],this.instance.colors[6],this.instance.colors[7]);if(this.blending){const t=ee(new j$1(0),i),e=ee(new j$1(0),r),o=ln(t,i).add(ln(e,r)),s=ee(o,new j$1(0)),d=new j$1(1).subtract(s),p=o.add(s),h=i.multiply(t).divide(p),c=r.multiply(e).divide(p),u=a.multiply(h).add(n.multiply(c));l=d.multiply(u);}else {const t=Bn(q(i),q(r)),e=ee(t,new j$1(0)),o=new j$1(1).subtract(e),s=ee(t,i),d=ee(t,r),p=a.multiply(s).add(n.multiply(d));l=o.multiply(p);}return e.glFragColor=l,e}hittest(t){return q$1(this.hittestRequest)}};e([K],_$1.prototype,"blending",void 0),e([g$3(V$2)],_$1.prototype,"instance",void 0),e([g$3(F$1)],_$1.prototype,"draw",void 0),e([t$5(0,m$a(D))],_$1.prototype,"vertex",null),e([t$5(0,m$a(F$3))],_$1.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const T$2={[C$2.BYTE]:1,[C$2.UNSIGNED_BYTE]:1,[C$2.SHORT]:2,[C$2.UNSIGNED_SHORT]:2,[C$2.HALF_FLOAT]:2,[C$2.INT]:4,[C$2.UNSIGNED_INT]:4,[C$2.FLOAT]:4};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let i$2 = class i{constructor(t,i){this._boundPart=null;const a=[];for(const e of i.vertex){const s=c$4.createVertex(t,F$4.STATIC_DRAW,e);a.push(s);}const u=[];for(const e of i.index||[]){const s=c$4.createIndex(t,F$4.STATIC_DRAW,e);u.push(s);}this.groups=[];for(const r of i.groups){let o;if(null!=r.index){if(!i.index)throw new Error("No index data.");const{BYTES_PER_ELEMENT:t}=i.index[r.index];2===t?o=C$2.UNSIGNED_SHORT:4===t&&(o=C$2.UNSIGNED_INT);}const d=null!=r.index?u[r.index]:null,c=new Map,l={},p={};for(const t of r.attributes){const{name:r,count:o,type:e,offset:s,normalized:i,divisor:u,stride:d,vertex:f,location:h}=t,b=`vertex-buffer-${f}`;let x=l[b];x||(x=l[b]=[]);const m=new t$6(r,o,e,s,d,i,u);x.push(m),c.set(r,h),p[b]=a[f];}const f=new o$4(t,c,l,p,d);this.groups.push({...r,vertexArray:f,locations:c,layout:l,indexing:o});}this.parts=i.parts;}bind(t,r){this._boundPart=r;const{group:o}=this.parts[this._boundPart],{vertexArray:e}=this.groups[o];t.bindVAO(e);}draw(r){if(null==this._boundPart)throw new Error("Mesh.bind() has not been called.");const{start:o,count:e}=this.parts[this._boundPart],{group:s}=this.parts[this._boundPart],{indexing:n,primitive:i}=this.groups[s];n?r.drawElements(i,e,n,o*T$2[n]):r.drawArrays(i,o,e);}unbind(t){this._boundPart=null,t.bindVAO(null);}destroy(){for(const{vertexArray:t}of this.groups)t.dispose();}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let r$1 = class r extends i$2{static create(e,o){const n=[];let{stride:s,hash:l}=o.layout;if(null==s){s=0;for(const{count:e,type:i,offset:r}of o.layout.attributes){if(null!=r)throw new Error("Stride cannot be computed automatically when attribute offsets are supplied explicitly.");s+=e*T$2[i];}}let u=0,a=0;for(const{count:i,name:r,offset:h,type:m,normalized:x}of o.layout.attributes){null!=h&&(a=h);const e={name:r,location:u,vertex:0,count:i,type:m,offset:a,stride:s,divisor:0,normalized:null!=x&&x};n.push(e),u++,a+=i*T$2[m];}const c={attributes:n,primitive:o.primitive};null!=o.index&&(c.index=0);let{count:d}=o;if(null==d&&(d=o.index?o.index.length:o.vertex.byteLength/s,Math.floor(d)!==d))throw new Error(`The byte length of vertex data must be an exact multiple of the stride, which is ${s}.`);const p={start:0,count:d,group:0,primitive:o.primitive},f={vertex:[o.vertex],parts:[p],groups:[c]};null!=o.index&&(f.index=[o.index]),null==l&&(l=t$7(n));return new r(e,f,{hash:l,attributes:n,stride:s})}constructor(t,e,i){super(t,e),this.layout=i;}bind(t,e=0){super.bind(t,e);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let p$9 = class p{constructor(){this._dotTextureSize=0,this._dotTextures=null,this._dotMesh=null;}destroy(){this._disposeTextures(),this._dotFBO&&this._dotFBO.dispose(),this._dotMesh&&this._dotMesh.destroy();}getFBO(t){if(null==this._dotFBO){const s=a$3,o=a$3,h=new e$1(s,o);h.samplingMode=L.NEAREST,h.wrapMode=D$1.CLAMP_TO_EDGE;const d=new s$3(t,new i$3(B.DEPTH_STENCIL,s,o));this._dotFBO=new E$1(t,h,d);}return this._dotFBO}getDotDensityMesh(t){if(null==this._dotMesh){const r=a$3,i=r*r,n=2,u=new Int16Array(i*n);for(let t=0;t<r;t++)for(let e=0;e<r;e++)u[n*(e+t*r)]=e,u[n*(e+t*r)+1]=t;const l=[{count:2,type:C$2.UNSIGNED_SHORT,name:"a_position",offset:0}],_={hash:t$7(l),attributes:l,stride:4};this._dotMesh=r$1.create(t,{primitive:E$2.POINTS,vertex:u,count:i,layout:_});}return this._dotMesh}getDotDensityTextures(e,s,o){if(this._dotTextureSize===s&&this._seed===o||(this._disposeTextures(),this._dotTextureSize=s,this._seed=o),null===this._dotTextures){const r=new t$8(o);this._dotTextures=[this._allocDotDensityTexture(e,s,r),this._allocDotDensityTexture(e,s,r)];}return this._dotTextures}_disposeTextures(){if(this._dotTextures){for(let t=0;t<this._dotTextures.length;t++)this._dotTextures[t].dispose();this._dotTextures=null;}}_allocDotDensityTexture(t,e,s){const o=new Float32Array(e*e*4);for(let r=0;r<o.length;r++)o[r]=s.getFloat();const i=new e$1;return i.dataType=U$1.FLOAT,i.samplingMode=L.NEAREST,i.width=e,i.height=e,new c$5(t,i,o)}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let w$3 = class w extends o$3{constructor(){super(...arguments),this.type=e$2.DotDensity,this.shaders={polygon:new _$1,point:new C,fill:new x$4},this._resources=new Map;}render(e,t){f$7(e)||p$a(e)?this._renderPolygons(e,t):this._renderDotDensity(e,t);}_renderPolygons(e,t){const{painter:i}=e;i.setShader({shader:this.shaders.fill,uniforms:{...y$3(e,t.target),visualVariableColor:null,visualVariableOpacity:null},defines:{...h$6(e)},optionalAttributes:{zoomRange:!1},useComputeBuffer:p$a(e)}),i.setPipelineState(M$1(e)),i.submitDraw(e,t);}_renderDotDensity(o,r){const{context:s,painter:u,requiredLevel:c}=o,p=r.instance.getInput().uniforms,h=this._getOrCreateResourcesRecord(s),m=h.getDotDensityTextures(s,a$3,p.seed),w=1/2**(c-r.target.key.level),g=a$3,x=g*window.devicePixelRatio*g*window.devicePixelRatio,D=1/w*(1/w),b=p.dotScale?o.state.scale/p.dotScale:1,y=p.dotValue*b*D;u.setShader({shader:this.shaders.polygon,uniforms:{...y$3(o,r.target),instance:{isActive:p.isActive,colors:p.colors,dotValue:Math.max(1,y)},draw:{dotTexture0:{unit:J,texture:m[0]},dotTexture1:{unit:K$1,texture:m[1]},tileZoomFactor:w,pixelRatio:window.devicePixelRatio,tileDotsOverArea:x/(a$3*window.devicePixelRatio*a$3*window.devicePixelRatio)}},defines:{...h$6(o),blending:p.blending},optionalAttributes:{},useComputeBuffer:!1}),u.setPipelineState(M$1(o));const R=s.getViewport();s.setViewport(0,0,a$3,a$3);const P=s.getBoundFramebufferObject(),S=h.getFBO(s);s.bindFramebuffer(S),s.setClearColor(0,0,0,0),u.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),u.updatePipelineState(s),s.clear(_$2.COLOR_BUFFER_BIT),u.submitDraw(o,r),s.bindFramebuffer(P),s.setViewport(R.x,R.y,R.width,R.height);const v=h.getFBO(s).colorTexture;u.setShader({shader:this.shaders.point,uniforms:{view:c$6(o,r.target),instance:{dotSize:p.dotSize},draw:{locations:{unit:J,texture:v},tileZoomFactor:1,pixelRatio:window.devicePixelRatio}},defines:{...h$6(o)},optionalAttributes:{},useComputeBuffer:!1}),u.setPipelineState({color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1}),u.submitDrawMesh(s,h.getDotDensityMesh(s));}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e);}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new p$9,this._resources.set(e,t)),t}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let m$9 = class m extends o$3{constructor(){super(...arguments),this.type=e$2.ComplexFill,this.shaders={geometry:new _$3};}render(e,n){const{context:u,painter:m}=e,p=n.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,n.target,p.uniforms),...y$3(e,n.target),mosaicInfo:m.textureManager.getMosaicInfo(u,n.textureKey),localTileOffset:w$5(n.target)},defines:{...h$6(e)},optionalAttributes:p.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function n$6(n){const t=1/n;return {antialiasing:t,blur:0+t}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let m$8 = class m extends o$3{constructor(){super(...arguments),this.type=e$2.ComplexOutlineFill,this.shaders={geometry:new C$3};}render(e,a){const{context:u,painter:m,pixelRatio:p}=e,f=a.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,a.target,f.uniforms),...y$3(e,a.target),antialiasingControls:n$6(p),mosaicInfo:m.textureManager.getMosaicInfo(u,a.textureKey),localTileOffset:w$5(a.target)},defines:{...h$6(e)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,a);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let u$6 = class u extends o$3{constructor(){super(...arguments),this.type=e$2.Fill,this.shaders={geometry:new x$4};}render(e,n){const{painter:a}=e,u=n.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,n.target,u.uniforms),...y$3(e,n.target)},defines:h$6(e),optionalAttributes:u.optionalAttributes,useComputeBuffer:p$a(e)}),a.setPipelineState(M$1(e)),a.submitDraw(e,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let l$3 = class l extends o$3{constructor(){super(...arguments),this.type=e$2.OutlineFill,this.shaders={geometry:new H$1};}render(e,n){const{painter:u,pixelRatio:l}=e,m=n.instance.getInput();u.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,n.target,m.uniforms),...y$3(e,n.target),antialiasingControls:n$6(l)},defines:{...h$6(e)},optionalAttributes:m.optionalAttributes,useComputeBuffer:p$a(e)}),u.setPipelineState(M$1(e)),u.submitDraw(e,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let m$7 = class m extends o$3{constructor(){super(...arguments),this.type=e$2.PatternFill,this.shaders={geometry:new z$3};}render(e,n){const{context:u,painter:m}=e,f=n.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,n.target,f.uniforms),...y$3(e,n.target),mosaicInfo:m.textureManager.getMosaicInfo(u,n.textureKey),localTileOffset:w$5(n.target)},defines:{...h$6(e)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,n);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let m$6 = class m extends o$3{constructor(){super(...arguments),this.type=e$2.PatternOutlineFill,this.shaders={geometry:new S$5};}render(e,a){const{context:l,painter:m,pixelRatio:p}=e,f=a.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,a.target,f.uniforms),...y$3(e,a.target),antialiasingControls:n$6(p),mosaicInfo:m.textureManager.getMosaicInfo(l,a.textureKey),localTileOffset:w$5(a.target)},defines:{...h$6(e)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,a);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let l$2 = class l{constructor(e,t,r,o){this.dataType=e,this.samplingMode=t,this.pixelFormat=r,this.internalFormat=o;}};function n$5(n,i){const{textureFloatLinear:f,colorBufferFloat:s}=n.capabilities,u=s?.textureFloat,_=s?.textureHalfFloat,m=s?.floatBlend,p=n.driverTest.floatBufferBlend.result;if(!u&&!_)throw new s$4("heatmap:missing-color-buffer-float","HeatmapRenderer requires the WebGL extension EXT_color_buffer_float or EXT_color_buffer_half_float or WEBGL_color_buffer_float.");if(!(m&&p||_))throw new s$4("heatmap:missing-float-blend","HeatmapRenderer requires the WebGL extension EXT_float_blend or EXT_color_buffer_half_float."+(p?"":" This device claims support for EXT_float_blend, but does not actually support it."));const c=u&&m&&p,d=_,h=f,b=!!s?.R32F,R=!!s?.R16F;if(c&&h)return h||i.warnOnce("Missing WebGL extension OES_texture_float_linear. Heatmap quality may be reduced."),new l$2(U$1.FLOAT,h?L.LINEAR:L.NEAREST,b?G$1.RED:G$1.RGBA,b?P$3.R32F:G$1.RGBA);if(d)return new l$2(U$1.HALF_FLOAT,L.LINEAR,R?G$1.RED:G$1.RGBA,R?P$3.R16F:G$1.RGBA);throw new s$4("heatmap:missing-hardware-support","HeatmapRenderer requires WebGL extensions that allow it to render and blend to float or half float textures.")}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const m$5=()=>n$7.getLogger("esri.views.2d.engine.webgl.shaderGraph.techniques.heatmap.HeatmapResources");let f$6 = class f{destroy(){this._accumulateFramebuffer=r$2(this._accumulateFramebuffer),this._resolveGradientTexture=r$2(this._resolveGradientTexture),this._prevGradientHash=null,this._qualityProfile=null;}get initialized(){return null!=this._accumulateFramebuffer&&null!=this._resolveGradientTexture}get accumulateFramebuffer(){return this._accumulateFramebuffer}get resolveGradientTexture(){return this._resolveGradientTexture}loadQualityProfile(e){if(null==this._qualityProfile){const r=n$5(e,m$5());this._qualityProfile={...r,defines:{usesHalfFloatPrecision:r.dataType!==U$1.FLOAT}};}return this._qualityProfile}ensureAccumulateFBO(e,r,t){if(null==this._accumulateFramebuffer){const{dataType:u,samplingMode:o,pixelFormat:m,internalFormat:f}=this.loadQualityProfile(e),h=new e$1(r,t);h.pixelFormat=m,h.internalFormat=f,h.dataType=u,h.samplingMode=o,h.wrapMode=D$1.CLAMP_TO_EDGE;const c=new i$3(B.DEPTH_STENCIL,r,t);this._accumulateFramebuffer=new E$1(e,h,c);}else {const{width:e,height:a}=this._accumulateFramebuffer;e===r&&a===t||this._accumulateFramebuffer.resize(r,t);}return this._accumulateFramebuffer}ensureResolveGradientTexture(e,r,t){if(null==this._resolveGradientTexture){const r=new e$1;r.wrapMode=D$1.CLAMP_TO_EDGE,this._resolveGradientTexture=new c$5(e,r);}else this._prevGradientHash!==r&&(this._resolveGradientTexture.resize(t.length/4,1),this._resolveGradientTexture.setData(t),this._prevGradientHash=r);return this._resolveGradientTexture}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function n$4(n){return n?.25:1}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let v$2 = class v extends S$4{};e([h$5(5,C$1)],v$2.prototype,"offset",void 0);let x$3 = class x extends F$3{};let g$2 = class g extends P$1{};e([g$3(j$1)],g$2.prototype,"radius",void 0),e([g$3(j$1)],g$2.prototype,"isFieldActive",void 0);class F extends P$2{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1;}vertex(t){const{radius:e,isFieldActive:s}=this.kernelControls,i=t.offset,o=s.multiply(this.storage.getVVData(t.id).x).add(new j$1(1).subtract(s)),l=this.view.displayViewScreenMat3.multiply(new G(t.pos,1)).add(this.view.displayViewMat3.multiply(new G(i,0)).multiply(e)),r=this.clip(t.id);return {glPosition:new H(l.xy,r,1),offset:i,fieldValue:o,color:new H(0),...this.maybeRunHittest(t,{},null)}}fragment(t){const{offset:e,fieldValue:s}=t,i=kn(e),o=ee(i,new j$1(1)),l=new j$1(1).subtract(i.multiply(i)),r=l.multiply(l),a=o.multiply(r).multiply(s).multiply(new j$1(n$4(this.usesHalfFloatPrecision)));return this.getFragmentOutput(new H(a),t)}hittest(t){const{viewMat3:e,tileMat3:s}=this.view,i=e.multiply(s).multiply(new G(t.pos,1));return R$2(i.xy,this.kernelControls.radius,this.hittestRequest.position)}}e([K],F.prototype,"usesHalfFloatPrecision",void 0),e([g$3(g$2)],F.prototype,"kernelControls",void 0),e([t$5(0,m$a(v$2))],F.prototype,"vertex",null),e([t$5(0,m$a(x$3))],F.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let x$2 = class x extends b$6{};e([h$5(0,C$1)],x$2.prototype,"pos",void 0);let f$5 = class f extends v$3{};let h$4 = class h extends P$1{};e([g$3(S$3)],h$4.prototype,"texture",void 0),e([g$3(C$1)],h$4.prototype,"minAndInvRange",void 0),e([g$3(j$1)],h$4.prototype,"normalization",void 0);let w$2 = class w extends P$1{};e([g$3(S$3)],w$2.prototype,"texture",void 0);let b$4 = class b extends j{constructor(){super(...arguments),this.usesHalfFloatPrecision=!1;}vertex(t){return {glPosition:new H(t.pos.multiply(2).subtract(1),1,1),uv:t.pos}}fragment(t){const{accumulatedDensity:e,gradient:o}=this;let r=se(e.texture,t.uv).r.multiply(new j$1(n$4(this.usesHalfFloatPrecision)));r=r.multiply(e.normalization),r=r.subtract(e.minAndInvRange.x).multiply(e.minAndInvRange.y);const s=se(o.texture,new C$1(r,.5)),n=new w$4;return n.glFragColor=new H(s.rgb.multiply(s.a),s.a),n}};e([K],b$4.prototype,"usesHalfFloatPrecision",void 0),e([g$3(h$4)],b$4.prototype,"accumulatedDensity",void 0),e([g$3(w$2)],b$4.prototype,"gradient",void 0),e([t$5(0,m$a(x$2))],b$4.prototype,"vertex",null),e([t$5(0,m$a(f$5))],b$4.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let p$8 = class p extends o$3{constructor(){super(...arguments),this.type=e$2.Heatmap,this.shaders={accumulate:new F,resolve:new b$4},this.postProcessingEnabled=!0,this._isBound=!1,this._resources=new Map,this.overrideStencilRef=f$4;}shutdown(e){super.shutdown(e),this._resources.get(e)?.destroy(),this._resources.delete(e),this._prevFBO=null,this._unbind();}render(e,n){const{context:o,painter:u,state:a}=e,d=n.instance.getInput(),{isFieldActive:l}=d.uniforms,c=this._getOrCreateResourcesRecord(o),h=c.loadQualityProfile(o);if(f$7(e))return;p$a(e)||this._bind(e,c,d),u.setShader({shader:this.shaders.accumulate,uniforms:{...y$3(e,n.target),kernelControls:{radius:g$1(d,a),isFieldActive:l?1:0}},defines:{...h$6(e),...h.defines},optionalAttributes:{},useComputeBuffer:p$a(e)});const p=p$a(e)?w$1:_;u.setPipelineState(p),u.submitDraw(e,n);}postProcess(e,s){if(p$a(e)||f$7(e))return;const{context:i,painter:n}=e,o=this._resources.get(i);if(null==this._prevFBO||null==this._prevViewport||!o?.initialized)return;const{defines:u}=o.loadQualityProfile(i),{minDensity:a,maxDensity:d,radius:l}=s.getInput().uniforms,c=8,h=9,p=o.accumulateFramebuffer,m=o.resolveGradientTexture;n.setShader({shader:this.shaders.resolve,uniforms:{accumulatedDensity:{texture:{unit:c,texture:p.colorTexture},minAndInvRange:[a,1/(d-a)],normalization:3/(l*l*Math.PI)},gradient:{texture:{unit:h,texture:m}}},defines:u,optionalAttributes:{},useComputeBuffer:!1}),i.bindFramebuffer(this._prevFBO),i.setViewport(0,0,this._prevViewport.width,this._prevViewport.height),i.bindTexture(p.colorTexture,c),i.bindTexture(m,h),n.setPipelineState(b$3),n.submitDrawQuad(i),this._unbind();}_getOrCreateResourcesRecord(e){let t=this._resources.get(e);return null==t&&(t=new f$6,this._resources.set(e,t)),t}_unbind(){this._prevFBO=null,this._prevViewport=null,this._isBound=!1;}_bind(e,t,r){if(this._isBound)return;const{context:s,state:i,pixelRatio:n}=e,o=s.getBoundFramebufferObject(),u=s.getViewport();this._prevFBO=o,this._prevViewport=u;const{gradient:a,gradientHash:d}=r.uniforms;t.ensureResolveGradientTexture(s,d,a);const{width:l,height:p}=u,f=m$4(g$1(r,i),n),_=l*f,w=p*f,b=t.ensureAccumulateFBO(s,_,w);s.blitFramebuffer(o,b,0,0,o.width,o.height,0,0,b.width,b.height,_$2.STENCIL_BUFFER_BIT,L.NEAREST),s.bindFramebuffer(b),s.setViewport(0,0,b.width,b.height),s.setColorMask(!0,!0,!0,!0),s.setClearColor(0,0,0,0),s.clear(_$2.COLOR_BUFFER_BIT),this._isBound=!0;}};function m$4(e,t){const r=t>1.5?.25:.5;return e<1/(2*r)?1:r}function f$4(e){return e.key.level+1}const _={color:{write:[!0,!0,!0,!0],blendMode:"additive"},depth:!1,stencil:{write:!1,test:{ref:f$4,compare:O.GEQUAL,mask:255,op:{fail:I.KEEP,zFail:I.KEEP,zPass:I.REPLACE}}}},w$1={..._,stencil:!1},b$3={color:{write:[!0,!0,!0,!0],blendMode:"composite"},depth:!1,stencil:!1};function g$1(e,t){const{referenceScale:r,radius:s}=e.uniforms;return s*(0!==r?r/t.scale:1)}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let d$2 = class d extends P$1{getVVRotationMat4(t){return xt(h$7(t),nt.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(t$9),r=Wn(e),o=tn(e);return new nt(o,r,0,0,r.multiply(new j$1(-1)),o,0,0,0,0,1,0,0,0,0,1)}))}getVVRotationMat3(t){return xt(h$7(t),tt$1.identity(),(()=>{const e=this._getNormalizedAngle(t).multiply(t$9),r=Wn(e),o=tn(e);return new tt$1(o,r,0,r.multiply(new j$1(-1)),o,0,0,0,1)}))}_getNormalizedAngle(t){const e=Bt(this.rotationType,new j$1(i$4.Arithmatic));return xt(e,new j$1(90).subtract(t),t)}};e([g$3(j$1)],d$2.prototype,"rotationType",void 0);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const Q=360/254;let T$1 = class T extends S$4{};e([h$5(3,H)],T$1.prototype,"color",void 0),e([h$5(4,C$1)],T$1.prototype,"offset",void 0),e([h$5(5,C$1)],T$1.prototype,"textureUV",void 0),e([h$5(6,j$1)],T$1.prototype,"fontSize",void 0),e([h$5(7,j$1)],T$1.prototype,"referenceSize",void 0),e([h$5(8,j$1)],T$1.prototype,"haloFontSize",void 0),e([h$5(9,H)],T$1.prototype,"haloColor",void 0),e([h$5(10,C$1)],T$1.prototype,"zoomRange",void 0),e([h$5(11,j$1)],T$1.prototype,"clipAngle",void 0),e([h$5(12,H)],T$1.prototype,"referenceSymbol",void 0);let X$1 = class X extends I$1{};e([h$5(13,C$1)],X$1.prototype,"offsetNextVertex1",void 0),e([h$5(14,C$1)],X$1.prototype,"offsetNextVertex2",void 0);let Y$1 = class Y extends F$3{};let $$1 = class $ extends P$2{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"]},this.isHaloPass=!1,this.isBackgroundPass=!1,this.isLabel=!1;}clipLabel(t,e,o){const s=e.multiply(Q),a=Xt(this.view.rotation.subtract(s)),l=Un(new j$1(360).subtract(a),a);let r=new j$1(0);const p=vn(this.view.currentZoom.multiply(rt)).divide(rt),n=t.x,c=t.y,f=new j$1(1).subtract(ee(n,p)).multiply(2),v=ee(new j$1(90),l).multiply(2),b=new j$1(2).multiply(new j$1(1).subtract(ee(p,c)));return r=r.add(o.multiply(f)),r=r.add(o.multiply(v)),r=r.add(b),r}vertex(t,e){const i=j$2(t.bitset,F$5),s=new j$1(1).subtract(i);let a=t.fontSize,l=a.divide(A$1);const r=this.isHaloPass?t.haloColor:this._getVertexColor(t),p=this.isLabel?this.storage.getAnimationValue(t.id):new j$1(1),n=this.isLabel?r.multiply(p):r,d=this.view.displayViewScreenMat3.multiply(new G(t.pos,1));let u=t.offset,y=new j$1(1),h=tt$1.identity(),S=new C$1(0);if(this.isLabel){if(!t.referenceSymbol)throw new Error("InternalError: Optional attribute 'referenceSymbol' expected for labels");const e=t.referenceSymbol,i=e.xy,s=e.z,a=this._unpackDirection(e.w),l=t$a(this,t.id,s).divide(2),r=a.multiply(l.add(U$2));S=i.add(r),u=u.add(S);}else {y=t$a(this,t.id,t.referenceSize).divide(t.referenceSize),a=a.multiply(y),l=l.multiply(y),u=u.multiply(y),h=n$8(this,t.id),u=h.multiply(new G(u,0)).xy;}const z=j$2(t.bitset,H$2),j=this._getViewRotationMatrix(z).multiply(new G(u,0));let M=this.isLabel?this.clipLabel(t.zoomRange,t.clipAngle,z):this.clip(t.id,t.zoomRange);M=this.isBackgroundPass?M.add(s.multiply(2)):M.add(i.multiply(2));const R=this.isLabel?Ht(Ct(M,new j$1(1)),Bt(p,new j$1(0))):new Y$2(!1),C=new H(d.xy.add(j.xy),M,1),O=t.textureUV.divide(this.mosaicInfo.size);let L=new j$1(0);if(this.isHaloPass){L=t.haloFontSize.divide(l).divide(G$2);}return {glPosition:C,color:n,size:l,textureUV:O,antialiasingWidth:new j$1(.105*A$1).divide(a).divide(this.view.pixelRatio),haloDistanceOffset:L,...this.maybeRunHittest(t,e,{vvSizeAdjustment:y,vvRotation:h,labelOffset:S,labelClipped:R})}}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}fragment(t){const e=new j$1(2/8),i=new j$1(1).subtract(e),o=se(this.mosaicInfo.texture,t.textureUV).a;let s=i.subtract(t.haloDistanceOffset);this.highlight&&(s=s.divide(2));const a=t.antialiasingWidth,l=te(s.subtract(a),s.add(a),o);return this.getFragmentOutput(t.color.multiply(l),t)}hittest(t,e,{vvSizeAdjustment:i,vvRotation:o,labelOffset:s,labelClipped:a}){let l,r,p;this.isLabel?(l=new G(t.offset.add(s),0),r=new G(e.offsetNextVertex1.add(s),0),p=new G(e.offsetNextVertex2.add(s),0)):(l=o.multiply(new G(t.offset.multiply(i),0)),r=o.multiply(new G(e.offsetNextVertex1.multiply(i),0)),p=o.multiply(new G(e.offsetNextVertex2.multiply(i),0)));const{viewMat3:n,tileMat3:d}=this.view,u=n.multiply(d).multiply(new G(t.pos,1)),m=u.add(d.multiply(l)).xy,y=u.add(d.multiply(r)).xy,h=u.add(d.multiply(p)).xy,f=P$4(this.hittestRequest.position,m.xy,y.xy,h.xy);return this.isLabel?xt(a,q$1(this.hittestRequest),f):f}_unpackDirection(t){const e=new O$1(t),i=Dt(e,new O$1(2)),o=Nt(e,new O$1(3));return new C$1(new j$1(i).subtract(1),new j$1(o).subtract(1))}_getVertexColor(t){let e=t.color;if(this.visualVariableColor){const i=this.storage.getColorValue(t.id);e=this.visualVariableColor.getColor(i,t.color,new Y$2(!1));}if(this.visualVariableOpacity){const i=this.storage.getOpacityValue(t.id),o=this.visualVariableOpacity.getOpacity(i);e=e.multiply(o);}return e}};e([_$4(f$8)],$$1.prototype,"visualVariableColor",void 0),e([_$4(h$8)],$$1.prototype,"visualVariableOpacity",void 0),e([_$4(d$2)],$$1.prototype,"visualVariableRotation",void 0),e([_$4(m$b)],$$1.prototype,"visualVariableSizeMinMaxValue",void 0),e([_$4(p$b)],$$1.prototype,"visualVariableSizeScaleStops",void 0),e([_$4(f$9)],$$1.prototype,"visualVariableSizeStops",void 0),e([_$4(l$4)],$$1.prototype,"visualVariableSizeUnitValue",void 0),e([g$3(p$c)],$$1.prototype,"mosaicInfo",void 0),e([K],$$1.prototype,"isHaloPass",void 0),e([K],$$1.prototype,"isBackgroundPass",void 0),e([K],$$1.prototype,"isLabel",void 0),e([t$5(0,m$a(T$1)),t$5(1,m$a(X$1))],$$1.prototype,"vertex",null),e([t$5(0,m$a(Y$1))],$$1.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let p$7 = class p extends o$3{constructor(){super(...arguments),this.type=e$2.Label,this.shaders={geometry:new $$1},this.drawPhase=E.LABEL|E.LABEL_ALPHA|E.HITTEST,this.symbologyPlane=S$2.TEXT;}render(e,s){const{context:t,painter:u}=e,m=h$6(e),p={...M$1(e)},d=s.instance.getInput(),h={shader:this.shaders.geometry,uniforms:{...d$4(e,s.target,d.uniforms),...y$3(e,s.target),mosaicInfo:u.textureManager.getMosaicInfo(t,s.textureKey)},defines:{...m,isHaloPass:!1,isBackgroundPass:!0,isLabel:!0},optionalAttributes:d.optionalAttributes,useComputeBuffer:p$a(e)};u.setShader(h),u.setPipelineState(p),u.submitDraw(e,s),u.setShader({...h,defines:{...m,isHaloPass:!0,isBackgroundPass:!1,isLabel:!0}}),u.setPipelineState(p),u.submitDraw(e,s),u.setShader({...h,defines:{...m,isHaloPass:!1,isBackgroundPass:!1,isLabel:!0}}),u.setPipelineState(p),u.submitDraw(e,s);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let p$6 = class p extends o$3{constructor(){super(...arguments),this.type=e$2.Line,this.shaders={geometry:new B$1},this.symbologyPlane=S$2.LINE;}render(e,t){const{painter:a,pixelRatio:u}=e,p=t.instance.getInput();a.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,t.target,p.uniforms),...y$3(e,t.target),antialiasingControls:n$6(u)},defines:{...h$6(e)},optionalAttributes:p.optionalAttributes,useComputeBuffer:p$a(e)}),a.setPipelineState(M$1(e)),a.submitDraw(e,t);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
class A extends q$2{}e([h$5(9,j$1)],A.prototype,"accumulatedDistance",void 0),e([h$5(10,C$1)],A.prototype,"segmentDirection",void 0),e([h$5(11,H)],A.prototype,"tlbr",void 0);class R extends B$1{_getLineWidthRatio(t,e){const s=new j$1(o$5),a=j$2(t.bitset,D$3);return a.multiply(Bn(e,new j$1(.25))).add(new j$1(1).subtract(a)).divide(s)}_getSDFAlpha(t){const{halfWidth:e,normal:i,tlbr:s,patternSize:a,accumulatedDistance:n,lineWidthRatio:l}=t,h=a.x.multiply(new j$1(2)).multiply(l),y=bn(n.divide(h)),w=new j$1(.25).multiply(i.y).add(new j$1(.5)),f=Sn(s.xy,s.zw,new C$1(y,w)),b=k(se(this.mosaicInfo.texture,f)).subtract(new j$1(.5)).multiply(e),x=Zt(new j$1(.5).subtract(b),new j$1(0),new j$1(1));return new H(x)}_getPatternColor(t){const{halfWidth:e,normal:i,color:s,accumulatedDistance:a,patternSize:n,sampleAlphaOnly:l,tlbr:p}=t,w=n.y.multiply(new j$1(2).multiply(e).divide(n.x)),f=bn(a.divide(w)),b=new j$1(.5).multiply(i.y).add(new j$1(.5)),x=Sn(p.xy,p.zw,new C$1(b,f));let g=se(this.mosaicInfo.texture,x);return null!=this.visualVariableColor&&(g=xt(Ct(l,new j$1(.5)),new H(s.a),s)),g}vertex(t,e){const{segmentDirection:i,tlbr:s,bitset:a}=t,n=T$3(this,t),l=t.accumulatedDistance.divide(this.view.displayZoomFactor).add(ln(i,n.scaledOffset)),r=new C$1(s.z.subtract(s.x),s.w.subtract(s.y)),m=s.divide(this.mosaicInfo.size.xyxy),c=j$2(a,E$3),p=j$2(a,q$3),u=xt(Ct(c,new j$1(.5)),this._getLineWidthRatio(t,n.scaledHalfWidth),new j$1(1));return {...n,tlbr:m,patternSize:r,accumulatedDistance:l,isSDF:c,sampleAlphaOnly:p,lineWidthRatio:u,...this.maybeRunHittest(t,e,n.halfWidth)}}fragment(t){const{color:e,opacity:i,isSDF:s}=t,a=D$2(t,this.antialiasingControls.blur),n=xt(Ct(s,new j$1(.5)),this._getSDFAlpha(t),this._getPatternColor(t)),l=e.multiply(i).multiply(a).multiply(n);return this.getFragmentOutput(l,t)}}e([g$3(p$c)],R.prototype,"mosaicInfo",void 0),e([t$5(0,m$a(A)),t$5(1,m$a(q$4))],R.prototype,"vertex",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let p$5 = class p extends o$3{constructor(){super(...arguments),this.type=e$2.TexturedLine,this.shaders={geometry:new R},this.symbologyPlane=S$2.LINE;}render(e,t){const{context:a,painter:m,pixelRatio:p}=e,f=t.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,t.target,f.uniforms),...y$3(e,t.target),antialiasingControls:n$6(p),mosaicInfo:m.textureManager.getMosaicInfo(a,t.textureKey)},defines:{...h$6(e)},optionalAttributes:f.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,t);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
class X extends S$4{}e([h$5(3,H)],X.prototype,"color",void 0),e([h$5(4,H)],X.prototype,"outlineColor",void 0),e([h$5(5,C$1)],X.prototype,"offset",void 0),e([h$5(6,C$1)],X.prototype,"textureUV",void 0),e([h$5(7,H)],X.prototype,"sizing",void 0),e([h$5(8,j$1)],X.prototype,"placementAngle",void 0),e([h$5(9,j$1)],X.prototype,"sizeRatio",void 0),e([h$5(10,C$1)],X.prototype,"zoomRange",void 0);class Y extends I$1{}e([h$5(12,C$1)],Y.prototype,"offsetNextVertex1",void 0),e([h$5(13,C$1)],Y.prototype,"offsetNextVertex2",void 0),e([h$5(14,C$1)],Y.prototype,"textureUVNextVertex1",void 0),e([h$5(15,C$1)],Y.prototype,"textureUVNextVertex2",void 0);class Z extends F$3{}function $(t,e,i,o){return e.multiply(t.x).add(i.multiply(t.y)).add(o.multiply(t.z))}function tt(t){return t.multiply(t).divide(128)}class et extends P$2{constructor(){super(...arguments),this.computeAttributes={offset:["offsetNextVertex1","offsetNextVertex2"],textureUV:["textureUVNextVertex1","textureUVNextVertex2"]};}vertex(t,e){const i=tt(t.sizing.x),o=tt(t.sizing.y),s=tt(t.sizing.z),l=t.placementAngle,r=j$2(t.bitset,o$7.bitset.isSDF),y=j$2(t.bitset,o$7.bitset.isMapAligned),h=j$2(t.bitset,o$7.bitset.scaleSymbolsProportionally),c=z$4(t.bitset,o$7.bitset.colorLocked),x=u$7(this,t.id),v=r$3(this,t.id,t.color,c).multiply(x),V=this.view.displayViewScreenMat3.multiply(new G(t.pos.xy,1)),w=t$a(this,t.id,s).divide(s),f=i.multiply(w),S=t.offset.xy.multiply(w);let b=o.multiply(h.multiply(w.subtract(1)).add(1));b=Un(b,Bn(f.subtract(.99),new j$1(0)));const g=Bn(b,new j$1(1)),z=Un(b,new j$1(1)),C=tt$1.fromRotation(l.multiply(c$7)),_=n$8(this,t.id),R=this._getViewRotationMatrix(y).multiply(_).multiply(C).multiply(new G(S.xy,0)),U=this.clip(t.id,t.zoomRange),N=new H(V.xy.add(R.xy),U,1),F=t.textureUV.divide(this.mosaicInfo.size),D=t.outlineColor.multiply(z),I=j$2(t.bitset,o$7.bitset.overrideOutlineColor),O=t.sizeRatio.multiply(f).multiply(.5);return {glPosition:N,color:v,textureUV:F,outlineColor:D,outlineSize:g,distanceToPx:O,isSDF:r,overrideOutlineColor:I,...this.maybeRunHittest(t,e,{pos:t.pos,size:f,sizeCorrection:w,isMapAligned:y,vvRotationMat3:_,placementMat3:C,outlineSize:g,distanceToPx:O,isSDF:r})}}fragment(t){const e=this._getColor(t.textureUV,t);return this.getFragmentOutput(e,t)}hittest(t,e,i){return xt(St(i.size,this.hittestRequest.smallSymbolSizeThreshold),this._hittestSmallMarker(t,e,i),this._hittestMarker(t,e,i))}_getViewRotationMatrix(t){const e=this.view.displayViewMat3,i=this.view.displayMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}_getViewScreenMatrix(t){const e=this.view.viewMat3.multiply(this.view.tileMat3),i=this.view.tileMat3,o=new j$1(1).subtract(t);return e.multiply(t).add(i.multiply(o))}_getColor(t,e){return xt(Bt(e.isSDF,new j$1(1)),this._getSDFColor(t,e),this._getSpriteColor(t,e))}_getSpriteColor(t,e){return se(this.mosaicInfo.texture,t).multiply(e.color)}_getSDFColor(t,e){const i=se(this.mosaicInfo.texture,t),o=new j$1(.5).subtract(k(i)).multiply(e.distanceToPx).multiply(o$6),s=Zt(new j$1(.5).subtract(o),new j$1(0),new j$1(1)),l=e.color.multiply(s);let r=e.outlineSize;this.highlight&&(r=Bn(r,e.overrideOutlineColor.multiply(4)));const a=r.multiply(.5),p=Xt(o).subtract(a),d=Zt(new j$1(.5).subtract(p),new j$1(0),new j$1(1)),m=Sn(e.outlineColor,e.color,e.overrideOutlineColor).multiply(d);return new j$1(1).subtract(m.a).multiply(l).add(m)}_hittestSmallMarker(t,e,i){const{position:o,distance:s,smallSymbolDistance:l}=this.hittestRequest,r=s.subtract(l),{viewMat3:p,tileMat3:n}=this.view,u=p.multiply(n).multiply(new G(i.pos,1)).xy,d=i.size.multiply(.5);return sn(u,o).subtract(d).add(r)}_hittestMarker(t,e,i){const{pos:o,sizeCorrection:s,isMapAligned:l}=i,r=new G(t.offset.multiply(s),0),p=new G(e.offsetNextVertex1.multiply(s),0),n=new G(e.offsetNextVertex2.multiply(s),0),{viewMat3:u,tileMat3:d}=this.view,m=u.multiply(d).multiply(new G(o,1)),h=this._getViewScreenMatrix(l).multiply(i.vvRotationMat3).multiply(i.placementMat3),c=m.add(h.multiply(r)).xy,x=m.add(h.multiply(p)).xy,v=m.add(h.multiply(n)).xy,V=this.hittestRequest.position,w=this.hittestRequest.distance,f=P$4(V,c,x,v);return xt(Ct(f,w),f,this._hittestSamples(c,x,v,t,e,i))}_hittestSamples(t,e,i,o,s,l){const{outlineSize:r,isSDF:a,distanceToPx:p}=l,n=this.hittestRequest.position,d=this.hittestRequest.distance,y=h$9(n.add(new C$1(yt(d),yt(d))),t,e,i),h=h$9(n.add(new C$1(0,yt(d))),t,e,i),c=h$9(n.add(new C$1(d,yt(d))),t,e,i),x=h$9(n.add(new C$1(yt(d),0)),t,e,i),v=h$9(n,t,e,i),V=h$9(n.add(new C$1(d,0)),t,e,i),w=h$9(n.add(new C$1(yt(d),d)),t,e,i),f=h$9(n.add(new C$1(0,d)),t,e,i),S=h$9(n.add(new C$1(d,d)),t,e,i),M=o.textureUV.divide(this.mosaicInfo.size),C=s.textureUVNextVertex1.divide(this.mosaicInfo.size),_=s.textureUVNextVertex2.divide(this.mosaicInfo.size),R={color:new H(1),outlineColor:new H(1),overrideOutlineColor:new j$1(1),outlineSize:r,distanceToPx:p,isSDF:a};let j=new j$1(0);return j=j.add(g$4(y).multiply(this._getColor($(y,M,C,_),R).a)),j=j.add(g$4(h).multiply(this._getColor($(h,M,C,_),R).a)),j=j.add(g$4(c).multiply(this._getColor($(c,M,C,_),R).a)),j=j.add(g$4(x).multiply(this._getColor($(x,M,C,_),R).a)),j=j.add(g$4(v).multiply(this._getColor($(v,M,C,_),R).a)),j=j.add(g$4(V).multiply(this._getColor($(V,M,C,_),R).a)),j=j.add(g$4(w).multiply(this._getColor($(w,M,C,_),R).a)),j=j.add(g$4(f).multiply(this._getColor($(f,M,C,_),R).a)),j=j.add(g$4(S).multiply(this._getColor($(S,M,C,_),R).a)),ee(j,new j$1(.05)).multiply(q$1(this.hittestRequest))}}e([_$4(f$8)],et.prototype,"visualVariableColor",void 0),e([_$4(h$8)],et.prototype,"visualVariableOpacity",void 0),e([_$4(d$2)],et.prototype,"visualVariableRotation",void 0),e([_$4(m$b)],et.prototype,"visualVariableSizeMinMaxValue",void 0),e([_$4(p$b)],et.prototype,"visualVariableSizeScaleStops",void 0),e([_$4(f$9)],et.prototype,"visualVariableSizeStops",void 0),e([_$4(l$4)],et.prototype,"visualVariableSizeUnitValue",void 0),e([g$3(p$c)],et.prototype,"mosaicInfo",void 0),e([t$5(0,m$a(X)),t$5(1,m$a(Y))],et.prototype,"vertex",null),e([t$5(0,m$a(Z))],et.prototype,"fragment",null);

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let u$5 = class u extends o$3{constructor(){super(...arguments),this.type=e$2.Marker,this.shaders={geometry:new et},this.symbologyPlane=S$2.MARKER;}render(e,t){const{context:a,painter:m}=e,u=t.instance.getInput();m.setShader({shader:this.shaders.geometry,uniforms:{...d$4(e,t.target,u.uniforms),...y$3(e,t.target),mosaicInfo:m.textureManager.getMosaicInfo(a,t.textureKey,!0)},defines:{...h$6(e)},optionalAttributes:u.optionalAttributes,useComputeBuffer:p$a(e)}),m.setPipelineState(M$1(e)),m.submitDraw(e,t);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let o$2 = class o{constructor(){this.computeAttributes={};}get locationsMap(){const t=new Map;for(const e in this.locations)t.set(e,this.locations[e].index);return t}get optionPropertyKeys(){if(!this._optionPropertyKeys){const t=new Set(Object.keys(this.options));this._optionPropertyKeys=t;}return this._optionPropertyKeys}get _transformFeedbackBindings(){return []}get locationInfo(){if(!this._locationInfo){const e=this.locationsMap,o=Array.from(e.entries()).map((([t,e])=>`${t}.${e}`)).join("."),n=l$5(o);this._locationInfo={hash:n,locations:e,computeAttributeMap:this.computeAttributes};}return this._locationInfo}get renamedLocationsMap(){const t=new Map;for(const[e,o]of this.locationsMap.entries())t.set("a_"+e,o);return t}getShaderKey(t,e,o){return `${Object.keys(t).map((e=>`${e}.${t[e]}`)).join(".")}.${Object.keys(o).filter((t=>o[t])).map((t=>`${t}_${o[t].toString()}`)).join(".")}.${Object.keys(e).filter((t=>this.optionPropertyKeys.has(t))).join(".")}`}getProgram(t,o,n,r){let i="",s="";for(const e in n)if(n[e]){const t="boolean"==typeof n[e]?`#define ${e}\n`:`#define ${e} ${n[e]}\n`;i+=t,s+=t;}return i+=this.vertexShader,s+=this.fragmentShader,new a$4(i,s,this.renamedLocationsMap,this.locationInfo,this._getUniformBindings(o),this._transformFeedbackBindings)}_getUniformBindings(t){const e=[];for(const o in this.required){const t=this.required[o];e.push({uniformHydrated:null,shaderModulePath:o,uniformName:o,uniformType:t.type,uniformArrayElementType:n$3(t),uniformArrayLength:r(t)});}for(const o in t){const i=this.options[o];if(t[o])for(const t in i){const s=i[t];e.push({uniformHydrated:null,shaderModulePath:`${o}.${t}`,uniformName:t,uniformType:s.type,uniformArrayElementType:n$3(s),uniformArrayLength:r(s)});}}return e}};const n$3=t=>"array"===t.type?t.elementType?.type:void 0,r=t=>"array"===t.type?t.size:void 0;

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const p$4={hittestDist:j$1,hittestPos:C$1},y$2={filterFlags:S$3,animation:S$3,visualVariableData:S$3,dataDriven0:S$3,dataDriven1:S$3,dataDriven2:S$3,gpgpu:S$3,size:j$1},d$1={displayViewScreenMat3:tt$1,displayViewMat3:tt$1,displayMat3:tt$1,viewMat3:tt$1,tileMat3:tt$1,displayZoomFactor:j$1,requiredZoomFactor:j$1,tileOffset:C$1,currentScale:j$1,currentZoom:j$1,metersPerSRUnit:j$1};let u$4 = class u extends o$2{constructor(){super(...arguments),this.vertexShader=n$9("materials/pie/pie.vert"),this.fragmentShader=n$9("materials/pie/pie.frag"),this.required={...y$2,...d$1,outlineWidth:j$1,colors:U,defaultColor:H,othersColor:H,outlineColor:H,donutRatio:j$1,sectorThreshold:j$1},this.options={hittestUniforms:p$4,visualVariableSizeMinMaxValue:{minMaxValueAndSize:H},visualVariableSizeScaleStops:{sizes:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},values:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}},visualVariableSizeStops:{sizes:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},values:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}},visualVariableSizeUnitValue:{unitValueToPixelsRatio:j$1},visualVariableOpacity:{opacities:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8},opacityValues:{...U.ofType(j$1,8),type:"array",elementType:j$1,size:8}}},this.locations={pos:{index:0,type:C$1},id:{index:1,type:G},bitset:{index:2,type:j$1},offset:{index:3,type:C$1},texCoords:{index:4,type:C$1},size:{index:5,type:C$1},referenceSize:{index:6,type:j$1},zoomRange:{index:7,type:C$1}},this.defines={VV_SIZE_MIN_MAX_VALUE:"boolean",VV_SIZE_SCALE_STOPS:"boolean",VV_SIZE_FIELD_STOPS:"boolean",VV_SIZE_UNIT_VALUE:"boolean",VV_OPACITY:"boolean",HITTEST:"boolean",numberOfFields:"number",highlight:"boolean",inside:"boolean",outside:"boolean"};}setNumberOfFields(e){this.required.colors={...U.ofType(H,e),type:"array",elementType:H,size:e};}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let h$3 = class h extends o$3{constructor(){super(...arguments),this.type=e$2.PieChart,this.shaders={geometry:new u$4},this.symbologyPlane=S$2.MARKER;}render(e,t){const{painter:u}=e,{instance:n,target:h}=t,m=this.shaders.geometry,l=n.getInput(),f=l.uniforms.numberOfFields,S=p$a(e),V=y$3(e,h),d=h$6(e);m.setNumberOfFields(f),u.setShader({shader:m,uniforms:{...d$4(e,t.target,l.uniforms.shader),...V.storage,...V.view,hittestUniforms:V.hittestRequest?{hittestDist:V.hittestRequest?.distance,hittestPos:V.hittestRequest?.position}:null},defines:{VV_SIZE_MIN_MAX_VALUE:!!l.uniforms.shader.visualVariableSizeMinMaxValue,VV_SIZE_SCALE_STOPS:!!l.uniforms.shader.visualVariableSizeScaleStops,VV_SIZE_FIELD_STOPS:!!l.uniforms.shader.visualVariableSizeStops,VV_SIZE_UNIT_VALUE:!!l.uniforms.shader.visualVariableSizeUnitValue,VV_OPACITY:!!l.uniforms.shader.visualVariableOpacity,HITTEST:S,highlight:V.highlight?1:0,...d,numberOfFields:f},optionalAttributes:{},useComputeBuffer:S}),u.setPipelineState(M$1(e)),u.submitDraw(e,t);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
let m$3 = class m extends o$3{constructor(){super(...arguments),this.type=e$2.Text,this.shaders={geometry:new $$1},this.symbologyPlane=S$2.TEXT;}render(e,s){const{context:n,painter:u}=e,m=h$6(e),d=s.instance.getInput(),f={shader:this.shaders.geometry,uniforms:{...d$4(e,s.target,d.uniforms),...y$3(e,s.target),mosaicInfo:u.textureManager.getMosaicInfo(n,s.textureKey)},defines:{...m,isHaloPass:!1,isBackgroundPass:!0,isLabel:!1},optionalAttributes:d.optionalAttributes,useComputeBuffer:p$a(e)};u.setShader(f),u.setPipelineState(M$1(e)),u.submitDraw(e,s),u.setShader({...f,defines:{...m,isHaloPass:!0,isBackgroundPass:!1,isLabel:!1}}),u.submitDraw(e,s),u.setShader({...f,defines:{...m,isHaloPass:!1,isBackgroundPass:!1,isLabel:!1}}),u.submitDraw(e,s);}};

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const h$2={fill:new u$6,patternFill:new m$7,complexFill:new m$9,outlineFill:new l$3,patternOutlineFill:new m$6,complexOutlineFill:new m$8,marker:new u$5,pieChart:new h$3,line:new p$6,texturedLine:new p$5,text:new m$3,label:new p$7,heatmap:new p$8,dotDensity:new w$3};function T(){for(const e in h$2){h$2[e].startup();}}function w(e){for(const i in h$2){h$2[i].shutdown(e);}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function n$2(n,t){const r=n.slice(0,t),e=t-r.length;for(let o=0;o<e;o++){const n=r[r.length-1];r.push(n);}return r}function t$3(n){if(!n)return [0,0,0,0];const{r:t,g:r,b:e,a:o}=n;return [t*(o/255),r*(o/255),e*(o/255),o]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const l$1=8,s$2=l$1-2,n$1=()=>n$7.getLogger("esri.views.2d.layers.features.support.rendererUtils");function u$3(e){return e.map((e=>a$2(e)?i$1(e.clone()):e))}function a$2(e){return ("size"===e.type||"color"===e.type||"opacity"===e.type)&&null!=e.stops}function i$1(e){return e.stops=b$2(e.type,e.stops??[]),e}function p$3(e,o,r){return (1-r)*e+r*o}function c$3(e,o){const[t,...l]=o,n=l.pop(),u=l[0].value,a=l[l.length-1].value,i=(a-u)/s$2,c=[];for(let s=u;s<a;s+=i){let t=0;for(;s>=l[t].value;)t++;const n=l[t],u=o[t-1],a=s-u.value,i=n.value===u.value?1:a/(n.value-u.value);if("color"===e){const e=l[t],r=o[t-1],n=e.color.clone();n.r=p$3(r.color.r,n.r,i),n.g=p$3(r.color.g,n.g,i),n.b=p$3(r.color.b,n.b,i),n.a=p$3(r.color.a,n.a,i),c.push({value:s,color:n,label:e.label});}else if("size"===e){const e=l[t],n=o[t-1],u=o$8(e.size),a=p$3(o$8(n.size),u,i);c.push({value:s,size:a,label:e.label});}else {const e=l[t],r=p$3(o[t-1].opacity,e.opacity,i);c.push({value:s,opacity:r,label:e.label});}}return [t,...c,n]}function f$3(e){const[o,...r]=e,t=r.pop();for(;r.length>s$2;){let e=0,o=0;for(let t=1;t<r.length;t++){const l=r[t-1],s=r[t],n=Math.abs(s.value-l.value);n>o&&(o=n,e=t);}r.splice(e,1);}return [o,...r,t]}function b$2(e,o){return o.length<=l$1?o:(n$1().warn(`Found ${o.length} Visual Variable stops, but MapView only supports ${l$1}. Displayed stops will be simplified.`),o.length>2*l$1?c$3(e,o):f$3(o))}function g(){const{supportsColorBufferFloat:e,supportsColorBufferFloatBlend:o,supportsColorBufferHalfFloat:r}=t$b();return e&&o||r}function m$2(o){if(!o)return !0;switch(o.type){case"dot-density":break;case"heatmap":if(!g()){const o=t$b(),r=["supportsColorBufferFloat","supportsColorBufferFloatBlend","supportsColorBufferHalfFloat"].filter((e=>!o[e])).join(", ");return n$1().errorOnce(new s$4("webgl-missing-extension",`Missing WebGL2 requirements for Heatmap: ${r}`)),!1}}return !0}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
const u$2=1.25,o$1=128,c$2=128;function p$2(e){if(!e.stops?.length)return null;const a=e.stops.sort(((e,a)=>e.value-a.value)),i=n$2(a,8),l=i.map((({value:e})=>e)),s=i.map((({color:e})=>t$3(e)));return {values:l,colors:s}}function v$1(e){if(!e.stops?.length)return null;const a=e.stops.sort(((e,a)=>e.value-a.value)),i=n$2(a,8);return {opacityValues:i.map((({value:e})=>e)),opacities:i.map((({opacity:e})=>e))}}function V$1(e){return {rotationType:"geographic"===e.rotationType?i$4.Geographic:i$4.Arithmatic}}function f$2(a){if(!a.stops?.length)return null;if(a.stops.some((e=>e.useMaxValue||e.useMinValue)))return (i,s)=>{const r=i.statisticsByLevel.get(s.key.level),n=a.stops.map((i=>({value:i.useMaxValue?r?.get(a.field)?.maxValue??0:i.useMinValue?r?.get(a.field)?.minValue??0:i.value,size:i.size?u$8(i.size):i$5}))).sort(((e,a)=>e.value-a.value)),u=n$2(n,8);return {values:u.map((({value:e})=>e)),sizes:u.map((({size:e})=>e))}};const i=a.stops.sort(((e,a)=>e.value-a.value)),s=n$2(i,8);return {values:s.map((({value:e})=>e)),sizes:s.map((({size:a})=>u$8(a)))}}function S$1(e){return l=>{const{state:s}=l;return {unitValueToPixelsRatio:W(s.spatialReference)/m$c[e.valueUnit??"meters"]/s.resolution}}}function b$1(e,a){const i=a.length;if(e<a[0].value||1===i)return a[0].size;for(let l=1;l<i;l++)if(e<a[l].value){const i=(e-a[l-1].value)/(a[l].value-a[l-1].value);return a[l-1].size+i*(a[l].size-a[l-1].size)}return a[i-1].size}function z$1(a){const{minDataValue:i,maxDataValue:l,minSize:s,maxSize:t}=a;if("object"==typeof s&&"object"==typeof t)return (a,r)=>{const n=a.state.scale,u=u$8(b$1(n,s.stops)),o=u$8(b$1(n,t.stops));return {minMaxValueAndSize:[i,l,u,o]}};if("object"==typeof s||"object"==typeof t)throw new Error("InternalError: Found a partial VisualVariableSizeMinMaxValue");return {minMaxValueAndSize:[i,l,u$8(s),u$8(t)]}}const x$1={visualVariableColor:null,visualVariableOpacity:null,visualVariableRotation:null,visualVariableSizeStops:null,visualVariableSizeScaleStops:null,visualVariableSizeOutlineScaleStops:null,visualVariableSizeUnitValue:null,visualVariableSizeMinMaxValue:null};function h$1(e,a=c$2,i=u$2){if(e.visualVariableSizeMinMaxValue)return e.visualVariableSizeMinMaxValue instanceof Function?o$1:Math.max(e.visualVariableSizeMinMaxValue.minMaxValueAndSize[3]*i,a);if(e.visualVariableSizeScaleStops){if(e.visualVariableSizeScaleStops instanceof Function)return o$1;const l=e.visualVariableSizeScaleStops.sizes;return Math.max(l[l.length-1]*i,a)}if(e.visualVariableSizeStops){if(e.visualVariableSizeStops instanceof Function)return o$1;const l=e.visualVariableSizeStops.sizes;return Math.max(l[l.length-1]*i,a)}return e.visualVariableSizeUnitValue?2*o$1:0}function M(e){const a={...x$1};if(!e||!("visualVariables"in e)||!e.visualVariables)return a;for(const i of u$3(e.visualVariables))switch(i.type){case"color":a.visualVariableColor=p$2(i);break;case"opacity":a.visualVariableOpacity=v$1(i);break;case"rotation":a.visualVariableRotation=V$1(i);break;case"size":switch(y$1(i)){case"field-stops":a.visualVariableSizeStops=f$2(i);break;case"scale-stops":"outline"===i.target?a.visualVariableSizeOutlineScaleStops=f$2(i):a.visualVariableSizeScaleStops=f$2(i);break;case"min-max":a.visualVariableSizeMinMaxValue=z$1(i);break;case"unit-value":a.visualVariableSizeUnitValue=S$1(i);}break}return a}function y$1(e){return "number"==typeof e.minDataValue&&"number"==typeof e.maxDataValue&&null!=e.minSize&&null!=e.maxSize?"min-max":"$view.scale"===e?.valueExpression&&Array.isArray(e.stops)?"scale-stops":null==e.field&&"$view.scale"===e?.valueExpression||!(Array.isArray(e.stops)||"levels"in e&&e.levels)?null!=e.field||"$view.scale"!==e?.valueExpression?"unit-value":null:"field-stops"}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function a$1(a){return !!(a.visualVariableSizeMinMaxValue||a.visualVariableSizeScaleStops||a.visualVariableSizeStops||a.visualVariableSizeUnitValue||a.visualVariableSizeOutlineScaleStops)}function i(a){return !!a.visualVariableRotation}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function t$2(e){return e.minScale||e.maxScale?{minScale:e.minScale??0,maxScale:e.maxScale??0}:null}function s$1(e){if(null==e)return null;if(Array.isArray(e)){const[a,i,l,o]=e;return [a,i,l,255*o]}return "string"==typeof e?e:{...e,defaultValue:s$1(e?.defaultValue)}}async function n(a,i){const{cimResourceManager:l,cimAnalyzer:o,scaleExpression:r}=i.schemaOptions;await Promise.all(ee$1.fetchResources(a.symbol,l,[]));const s=o.analyzeSymbolReference(a,!1),n={scaleInfo:t$2(a),scaleExpression:r},u=[];for(const e of s)switch(e.type){case"marker":u.push(...c$1(e,i,n));break;case"fill":u.push(...m$1(e,i,n));break;case"line":u.push(...S(e,i,n));break;case"text":u.push(...v(e,i,n));}return u}function c$1(e,a,o){const{uniforms:r,schemaOptions:t}=a,{store:s}=t,n=e.isOutline?{...x$1,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue,visualVariableRotation:r.visualVariableRotation};return u$1(s.ensureInstance(h$2.marker,{uniforms:n,optionalAttributes:{zoomRange:!!o.scaleInfo}}),e,r,o)}function u$1(e,i,l,{scaleInfo:t,scaleExpression:n}){const c=a$1(l);return [e.createMeshInfo({size:i.size,scaleX:i.scaleX,anchorX:i.anchorPoint.x,anchorY:i.anchorPoint.y,angle:i.rotation,color:s$1(i.color)??[0,0,0,0],colorLocked:i.colorLocked,frameHeight:i.frameHeight,widthRatio:i.widthRatio,scaleInfo:t,offsetX:i.offsetX,offsetY:i.offsetY,outlineColor:s$1(i.outlineColor)??[0,0,0,0],outlineSize:i.outlineWidth,referenceSize:i.referenceSize||t$c.CIMVectorMarker.size,rotateClockwise:i.rotateClockwise,scaleFactor:n??1,sizeRatio:i.sizeRatio,alignment:i.alignment,isAbsoluteAnchorPoint:i.isAbsoluteAnchorPoint,scaleSymbolsProportionally:i.scaleSymbolsProportionally,sprite:i.spriteRasterizationParam,hasSizeVV:c,placement:i.markerPlacement,effects:i.effects?{type:"cim-effect-infos",effectInfos:i.effects}:null,transforms:i.transform,minPixelBuffer:h$1(l)})]}function f$1(e,a,l){const{uniforms:o,schemaOptions:r}=a,{store:t}=r;return p$1(t.ensureInstance(h$2.fill,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity},optionalAttributes:{zoomRange:!!l.scaleInfo}}),e,l)}function p$1(e,a,{scaleInfo:i}){return [e.createMeshInfo({color:s$1(a.color)??[0,0,0,0],scaleInfo:i,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function m$1(e,a,l){if(!e.spriteRasterizationParam)return f$1(e,a,l);const{uniforms:o,schemaOptions:r}=a,{store:t}=r;return b(t.ensureInstance(h$2.complexFill,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity},optionalAttributes:{zoomRange:!!l.scaleInfo}}),e,null!=o.visualVariableColor,l)}function b(e,a,i,{scaleInfo:l}){if(!a.spriteRasterizationParam)throw new Error("InternalError: Sprite should always be defined");const o=!!a.hasUnresolvedReplacementColor&&(!i||a.colorLocked),r=a.sampleAlphaOnly&&!o,t=a.spriteRasterizationParam;return [e.createMeshInfo({color:s$1(a.color)??[0,0,0,0],height:a.height,aspectRatio:a.scaleX,offsetX:a.offsetX,offsetY:a.offsetY,scaleX:1,scaleY:1,angle:a.angle,applyRandomOffset:a.applyRandomOffset,sampleAlphaOnly:r,scaleProportionally:"CIMHatchFill"===t.resource.type,sprite:t,scaleInfo:l,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null})]}function S(e,a,o){const{uniforms:r,schemaOptions:t}=a,{store:s}=t,n=e.isOutline?{...x$1,visualVariableSizeScaleStops:r.visualVariableSizeOutlineScaleStops}:{visualVariableColor:e.colorLocked?null:r.visualVariableColor,visualVariableOpacity:r.visualVariableOpacity,visualVariableSizeMinMaxValue:r.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:r.visualVariableSizeScaleStops,visualVariableSizeStops:r.visualVariableSizeStops,visualVariableSizeUnitValue:r.visualVariableSizeUnitValue},c={uniforms:n,optionalAttributes:{zoomRange:!!o.scaleInfo}},u=!!(n.visualVariableSizeMinMaxValue||n.visualVariableSizeScaleStops||n.visualVariableSizeStops||n.visualVariableSizeUnitValue);if(!e.spriteRasterizationParam){return h(s.ensureInstance(h$2.line,c),e,u,o)}return z(s.ensureInstance(h$2.texturedLine,c),e,u,o)}function V(e,a,{scaleInfo:i}){return {color:s$1(e.color)??[0,0,0,0],width:e.width,referenceWidth:e.referenceWidth,capType:e.cap,joinType:e.join,miterLimit:e.miterLimit,scaleInfo:i,hasSizeVV:a,effects:e.effects?{type:"cim-effect-infos",effectInfos:e.effects}:null}}function h(e,a,i,l){if(a.spriteRasterizationParam)throw new Error("InternalError: Sprite should not be defined");const o=V(a,i,l);return [e.createMeshInfo(o)]}function z(e,a,i,l){const{spriteRasterizationParam:o,scaleDash:r,sampleAlphaOnly:t}=a;if(!o)throw new Error("InternalError: Sprite should be defined");return [e.createMeshInfo({...V(a,i,l),shouldScaleDash:r??!1,shouldSampleAlphaOnly:t,isSDF:"CIMPictureStroke"!==o.resource.type,sprite:o})]}function v(e,a,l){const{uniforms:o,schemaOptions:r}=a,{store:t}=r;return y(t.ensureInstance(h$2.text,{uniforms:{visualVariableColor:e.colorLocked?null:o.visualVariableColor,visualVariableOpacity:o.visualVariableOpacity,visualVariableRotation:o.visualVariableRotation,visualVariableSizeMinMaxValue:o.visualVariableSizeMinMaxValue,visualVariableSizeScaleStops:o.visualVariableSizeScaleStops,visualVariableSizeStops:o.visualVariableSizeStops,visualVariableSizeUnitValue:o.visualVariableSizeUnitValue},optionalAttributes:{zoomRange:!!l.scaleInfo,referenceSymbol:!1,clipAngle:!1}}),e,o,l)}function y(e,a,i,{scaleInfo:l,scaleExpression:r}){return [e.createMeshInfo({boxBackgroundColor:s$1(a.backgroundColor),boxBorderLineColor:s$1(a.borderLineColor),boxBorderLineSize:a.borderLineWidth??0,color:s$1(a.color)??[0,0,0,0],offsetX:a.offsetX,offsetY:a.offsetY,postAngle:a.angle,fontSize:a.size,referenceSize:a.referenceSize,decoration:a.decoration,haloColor:s$1(a.outlineColor)??[0,0,0,0],haloFontSize:a.outlineSize,lineWidth:a.lineWidth||512,lineHeightRatio:1,horizontalAlignment:a.horizontalAlignment??"center",verticalAlignment:a.verticalAlignment??"baseline",useCIMAngleBehavior:!1,glyphs:a.textRasterizationParam,scaleInfo:l,effects:a.effects?{type:"cim-effect-infos",effectInfos:a.effects}:null,placement:a.markerPlacement,transforms:a.transform,scaleFactor:r??1,minPixelBuffer:h$1(i),repeatLabel:null,repeatLabelDistance:null,allowOverrun:null,labelPosition:null,isLineLabel:!1})]}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function t$1(e,i){return {type:"simple",filters:i,capabilities:{maxTextureSize:t$b().maxTextureSize},bindings:a(e)}}function s(e){switch(e){case"opacity":return L$1.OPACITY;case"color":return L$1.COLOR;case"rotation":return L$1.ROTATION;case"size":return L$1.SIZE;default:return null}}function a(e){if(!e)return [];switch(e.type){case"simple":case"class-breaks":case"unique-value":case"dictionary":return c(e);case"dot-density":return o(e);case"pie-chart":return l(e);case"heatmap":return u(e)}}function o(e){const i=[];for(const n of e.attributes)i.push({binding:i.length,expression:n.valueExpression,field:n.field});return i}function l(e){const i=c(e);let n=4;for(const r of e.attributes)i.push({binding:n++,expression:r.valueExpression,field:r.field});return i}function u({valueExpression:e,field:i}){return e||i?[{binding:0,expression:e,field:i}]:[]}function c(i){if(!("visualVariables"in i)||!i.visualVariables?.length)return [];return u$3(i.visualVariables).map((e=>x(e))).filter(O$2)}function p(e){return "$view.scale"===e.valueExpression?null:{binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression,valueRepresentation:e.valueRepresentation}}function f(e){return {binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function d(e){return {binding:s(e.type),field:e.field,normalizationField:e.normalizationField,expression:e.valueExpression}}function m(e){return {binding:s(e.type),expression:e.valueExpression,field:e.field}}function x(e){switch(e.type){case"size":return p(e);case"color":return f(e);case"opacity":return d(e);case"rotation":return m(e)}}

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
class t{constructor(e){this.updateTracking=new d$5({debugName:"FeatureCommandQueue"}),this._queueProcessor=new _$5({concurrency:1,process:e.process});}destroy(){this.updateTracking.destroy(),this._queueProcessor.destroy(),this.clear();}clear(){this._queueProcessor.clear();}async push(s){return d$6(this.updateTracking.addPromise(this._doPush(s)))}async _doPush(e){const s=this._queueProcessor,r=s.last();switch(e.type){case"update":case"highlight":if(r?.type===e.type)return;return s.push(e);case"edit-by-id":case"edit-by-feature":return s.push(e)}}}

export { M, T, h as a, b, t as c, t$1 as d, t$3 as e, h$1 as f, a$1 as g, h$2 as h, i, c as j, m$2 as m, n, p$1 as p, t$2 as t, u$1 as u, w, x$1 as x, y, z };
