import { m } from './TimeOnly-BZ2-EQE7.js';
import { a as ae$1, v as te$1, w as ee$1, B, N, b as a, r, G, m as me, y as he, A as He, X as X$1, W, P, F as Ne, U, H, I as t, Q, _ as _$1, g as ge, D, K as Re, S as v, T as y$1, V, $ as l$1 } from './arcadeUtils-CijaeIuc.js';
import { q, G as G$1, d, c, e, a as a$1, b as a$2, T, E, N as N$1, O, B as B$1, f as b, k, L, I } from './featureSetUtils-B7EqkLKl.js';
import { t as t$1 } from './ImmutableArray-B20xHd08.js';
import { l } from './portalUtils-CSt0Towt.js';
import { u, D as D$1 } from './SpatialFilter-CX-L7auf.js';
import { C, e$ as S, eN as Ze, dV as y } from './main-CGBWc59Z.js';
import { O as O$1 } from './WhereClause-3pL4DCSU.js';
import './preload-helper-dJJaZANz.js';
import './number-D5Hw0YeC.js';
import './geometryEngineAsync-Di200sKf.js';

/*
All material copyright ESRI, All Rights Reserved, unless otherwise specified.
See https://js.arcgis.com/4.30/esri/copyright.txt for details.
*/
function X(e){if(1===e.length){if(U(e[0]))return l$1("distinct",e[0],-1);if(Q(e[0]))return l$1("distinct",e[0].toArray(),-1)}return l$1("distinct",e,-1)}async function ee(e,t,n){const a=e.getVariables();if(a.length>0){const i=[];for(let e=0;e<a.length;e++){const r={name:a[e]};i.push(await t.evaluateIdentifier(n,r));}const r={};for(let e=0;e<a.length;e++)r[a[e]]=i[e];return e.parameters=r,e}return e}function te(e,t,n=null){for(const a in e)if(a.toLowerCase()===t.toLowerCase())return e[a];return n}function ne(e){if(null===e)return null;const t={type:te(e,"type",""),name:te(e,"name","")};if("range"===t.type)t.range=te(e,"range",[]);else {t.codedValues=[];for(const n of te(e,"codedValues",[]))t.codedValues.push({name:te(n,"name",""),code:te(n,"code",null)});}return t}function ae(e){if(null===e)return null;const t={},n=te(e,"wkt");null!==n&&(t.wkt=n);const a=te(e,"wkid");return null!==a&&(t.wkid=a),t}function ie(e){if(null===e)return null;const t={hasZ:te(e,"hasz",!1),hasM:te(e,"hasm",!1)},n=te(e,"spatialreference");null!=n&&(t.spatialReference=ae(n));const a=te(e,"x",null);if(null!==a)return t.x=a,t.y=te(e,"y",null),t.hasZ&&(t.z=te(e,"z",null)),t.hasM&&(t.m=te(e,"m",null)),t;const i=te(e,"rings",null);if(null!==i)return t.rings=i,t;const r=te(e,"paths",null);if(null!==r)return t.paths=r,t;const s=te(e,"points",null);if(null!==s)return t.points=s,t;for(const o of ["xmin","xmax","ymin","ymax","zmin","zmax","mmin","mmax"]){const n=te(e,o,null);null!==n&&(t[o]=n);}return t}function re(e,t){for(const n of t)if(n===e)return !0;return !1}function se(e){return !!e.layerDefinition&&(!!e.featureSet&&(!1!==re(e.layerDefinition.geometryType,["",null,"esriGeometryNull","esriGeometryPoint","esriGeometryPolyline","esriGeometryPolygon","esriGeometryMultipoint","esriGeometryEnvelope"])&&(!1!==U(e.layerDefinition.fields)&&!1!==U(e.featureSet.features))))}function oe(e){return "utc"===e?.toLowerCase()?"UTC":"unknown"===e?.toLowerCase()?"Unknown":e}function le(q$1){"async"===q$1.mode&&(q$1.functions.timezone=function(t,r$1){return q$1.standardFunctionAsync(t,r$1,(async(s,o,l)=>{if(ae$1(l,1,2,t,r$1),te$1(l[0]))return "Unknown";if(ee$1(l[0]))return "Unknown";if(B(l[0])){if(await l[0].load(),1===l.length||null===l[1])return l[0].datesInUnknownTimezone?oe("unknown"):oe(l[0].dateFieldsTimeZone);if(!(l[1]instanceof N)||!1===l[1].hasField("type"))throw new a(t,r.InvalidParameter,r$1);const e=l[1].field("type");if(!1===G(e))throw new a(t,r.InvalidParameter,r$1);switch(me(e).toLowerCase()){case"preferredtimezone":return oe(l[0].preferredTimeZone);case"editfieldsinfo":return oe(l[0].editFieldsInfo?.timeZone??null);case"timeinfo":return oe(l[0].timeInfo?.timeZone??null);case"field":if(l[1].hasField("fieldname")&&G(l[1].field("fieldname")))return oe(l[0].fieldTimeZone(me(l[1].field("fieldname"))))}throw new a(t,r.InvalidParameter,r$1)}const f=he(l[0],He(t));if(null===f)return null;const u=f.timeZone;return "system"===u?m.systemTimeZoneCanonicalName:"utc"===u.toLowerCase()?"UTC":"unknown"===u.toLowerCase()?"Unknown":u}))},q$1.functions.sqltimestamp=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{ae$1(s,1,3,e,t);const o=s[0];if(X$1(o)){if(1===s.length)return o.toSQLWithKeyword();if(2===s.length)return o.changeTimeZone(me(s[1])).toSQLWithKeyword();throw new a(e,r.InvalidParameter,t)}if(ee$1(o))return o.toSQLWithKeyword();if(B(o)){if(3!==s.length)throw new a(e,r.InvalidParameter,t);await o.load();const n=me(s[1]);if(ee$1(s[2]))return s[2].toSQLWithKeyword();if(!1===X$1(s[2]))throw new a(e,r.InvalidParameter,t);const r$1=o.fieldTimeZone(n);return null===r$1?s[2].toSQLWithKeyword():s[2].changeTimeZone(r$1).toSQLWithKeyword()}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"sqltimestamp",min:2,max:4}),q$1.functions.featuresetbyid=function(e,t){return q$1.standardFunctionAsync(e,t,((n,r$1,s)=>{if(ae$1(s,2,4,e,t),W(s[0])){const n=me(s[1]);let r$1=P(s[2],null);const o=Ne(P(s[3],!0));if(null===r$1&&(r$1=["*"]),!1===U(r$1))throw new a(e,r.InvalidParameter,t);return s[0].featureSetById(n,o,r$1)}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"featuresetbyid",min:2,max:4}),q$1.functions.getfeatureset=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,o)=>{if(ae$1(o,1,2,e,t),H(o[0])){let t=P(o[1],"datasource");return null===t&&(t="datasource"),t=me(t).toLowerCase(),q(o[0].fullSchema(),t,e.lrucache,e.interceptor,e.spatialReference??null)}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"getfeatureset",min:1,max:2}),q$1.functions.featuresetbyportalitem=function(e,n){return q$1.standardFunctionAsync(e,n,((r$1,s,l$1)=>{if(ae$1(l$1,2,5,e,n),null===l$1[0])throw new a(e,r.PortalRequired,n);if(l$1[0]instanceof t){const t=me(l$1[1]),r$1=me(l$1[2]);let s=P(l$1[3],null);const f=Ne(P(l$1[4],!0));if(null===s&&(s=["*"]),!1===U(s))throw new a(e,r.InvalidParameter,n);let u;return u=e.services?.portal?e.services.portal:C.getDefault(),u=l(l$1[0],u),G$1(t,r$1,e.spatialReference??null,s,f,u,e.lrucache,e.interceptor)}if(!1===G(l$1[0]))throw new a(e,r.PortalRequired,n);const f=me(l$1[0]),u=me(l$1[1]);let d=P(l$1[2],null);const c=Ne(P(l$1[3],!0));if(null===d&&(d=["*"]),!1===U(d))throw new a(e,r.InvalidParameter,n);return G$1(f,u,e.spatialReference??null,d,c,e.services?.portal??C.getDefault(),e.lrucache,e.interceptor)}))},q$1.signatures.push({name:"featuresetbyportalitem",min:2,max:5}),q$1.functions.featuresetbyname=function(e,t){return q$1.standardFunctionAsync(e,t,((n,r$1,s)=>{if(ae$1(s,2,4,e,t),W(s[0])){const n=me(s[1]);let r$1=P(s[2],null);const o=Ne(P(s[3],!0));if(null===r$1&&(r$1=["*"]),!1===U(r$1))throw new a(e,r.InvalidParameter,t);return s[0].featureSetByName(n,o,r$1)}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"featuresetbyname",min:2,max:4}),q$1.functions.featureset=function(e,t){return q$1.standardFunction(e,t,((r$1,s,o)=>{ae$1(o,1,1,e,t);const l={layerDefinition:{geometryType:"",objectIdField:"",globalIdField:"",typeIdField:"",hasM:!1,hasZ:!1,fields:[]},featureSet:{geometryType:"",features:[]}};if(G(o[0])){const e=JSON.parse(o[0]);void 0!==e.layerDefinition?(l.layerDefinition=e.layerDefinition,l.featureSet=e.featureSet,e.layerDefinition.spatialReference&&(l.layerDefinition.spatialReference=e.layerDefinition.spatialReference)):(l.featureSet.features=e.features,l.featureSet.geometryType=e.geometryType,l.layerDefinition.geometryType=l.featureSet.geometryType,l.layerDefinition.objectIdField=e.objectIdFieldName??"",l.layerDefinition.typeIdField=e.typeIdFieldName,l.layerDefinition.globalIdField=e.globalIdFieldName,l.layerDefinition.fields=e.fields,e.spatialReference&&(l.layerDefinition.spatialReference=e.spatialReference));}else {if(!(o[0]instanceof N))throw new a(e,r.InvalidParameter,t);{const n=JSON.parse(o[0].castToText(!0)),r$1=te(n,"layerdefinition");if(null!==r$1){l.layerDefinition.geometryType=te(r$1,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.globalIdField=te(r$1,"globalidfield",""),l.layerDefinition.objectIdField=te(r$1,"objectidfield",""),l.layerDefinition.typeIdField=te(r$1,"typeidfield",""),l.layerDefinition.hasZ=!0===te(r$1,"hasz",!1),l.layerDefinition.hasM=!0===te(r$1,"hasm",!1);const e=te(r$1,"spatialreference");e&&(l.layerDefinition.spatialReference=ae(e));const t=[];for(const n of te(r$1,"fields",[])){const e={name:te(n,"name",""),alias:te(n,"alias",""),type:te(n,"type",""),nullable:te(n,"nullable",!0),editable:te(n,"editable",!0),length:te(n,"length",null),domain:ne(te(n,"domain"))};t.push(e);}l.layerDefinition.fields=t;const a=te(n,"featureset");if(a){const e={};for(const n of t)e[n.name.toLowerCase()]=n.name;for(const t of te(a,"features",[])){const n={},a=te(t,"attributes",{});for(const t in a)n[e[t.toLowerCase()]]=a[t];l.featureSet.features.push({attributes:n,geometry:ie(te(t,"geometry"))});}}}else {l.layerDefinition.hasZ=!0===te(n,"hasz",!1),l.layerDefinition.hasM=!0===te(n,"hasm",!1),l.layerDefinition.geometryType=te(n,"geometrytype",""),l.featureSet.geometryType=l.layerDefinition.geometryType,l.layerDefinition.objectIdField=te(n,"objectidfieldname",""),l.layerDefinition.typeIdField=te(n,"typeidfieldname","");const r$1=te(n,"spatialreference");r$1&&(l.layerDefinition.spatialReference=ae(r$1));const s=[],o=te(n,"fields",null);if(!U(o))throw new a(e,r.InvalidParameter,t);for(const e of o){const t={name:te(e,"name",""),alias:te(e,"alias",""),type:te(e,"type",""),nullable:te(e,"nullable",!0),editable:te(e,"editable",!0),length:te(e,"length",null),domain:ne(te(e,"domain"))};s.push(t);}l.layerDefinition.fields=s;const f={};for(const e of s)f[e.name.toLowerCase()]=e.name;let u=te(n,"features",null);if(U(u))for(const e of u){const t={},n=te(e,"attributes",{});for(const e in n)t[f[e.toLowerCase()]]=n[e];l.featureSet.features.push({attributes:t,geometry:ie(te(e,"geometry",null))});}else u=null,l.featureSet.features=u;}}}if(!1===se(l))throw new a(e,r.InvalidParameter,t);return l.layerDefinition.geometryType||(l.layerDefinition.geometryType="esriGeometryNull"),d.create(l,e.spatialReference)}))},q$1.signatures.push({name:"featureset",min:1,max:1}),q$1.functions.filter=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{if(ae$1(s,2,2,e,t),U(s[0])||Q(s[0])){const n=[];let r$1,o=s[0];if(o instanceof t$1&&(o=o.toArray()),!_$1(s[1]))throw new a(e,r.InvalidParameter,t);r$1=s[1].createFunction(e);for(const e of o){const t=r$1(e);S(t)?!0===await t&&n.push(e):!0===t&&n.push(e);}return n}if(B(s[0])){const t=await s[0].load(),n=O$1.create(s[1],t.getFieldsIndex(),t.dateFieldsTimeZoneDefaultUTC),a=n.getVariables();if(a.length>0){const t=[];for(let n=0;n<a.length;n++){const i={name:a[n]};t.push(await q$1.evaluateIdentifier(e,i));}const i={};for(let e=0;e<a.length;e++)i[a[e]]=t[e];return n.parameters=i,new c({parentfeatureset:s[0],whereclause:n})}return new c({parentfeatureset:s[0],whereclause:n})}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"filter",min:2,max:2}),q$1.functions.orderby=function(e$1,t){return q$1.standardFunctionAsync(e$1,t,(async(n,r$1,s)=>{if(ae$1(s,2,2,e$1,t),B(s[0])){const e$1=new e(s[1]);return new a$1({parentfeatureset:s[0],orderbyclause:e$1})}throw new a(e$1,r.InvalidParameter,t)}))},q$1.signatures.push({name:"orderby",min:2,max:2}),q$1.functions.top=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{if(ae$1(s,2,2,e,t),B(s[0]))return new a$2({parentfeatureset:s[0],topnum:s[1]});if(U(s[0]))return ge(s[1])>=s[0].length?s[0].slice(0):s[0].slice(0,ge(s[1]));if(Q(s[0]))return ge(s[1])>=s[0].length()?s[0].slice(0):s[0].slice(0,ge(s[1]));throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"top",min:2,max:2}),q$1.functions.first=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,a,i)=>{if(ae$1(i,1,1,e,t),B(i[0])){const t=await i[0].first(n.abortSignal);if(null!==t){const n=D.createFromGraphicLikeObject(t.geometry,t.attributes,i[0],e.timeZone);return n._underlyingGraphic=t,n}return t}return U(i[0])?0===i[0].length?null:i[0][0]:Q(i[0])?0===i[0].length()?null:i[0].get(0):null}))},q$1.signatures.push({name:"first",min:1,max:1}),q$1.functions.attachments=function(e,t){return q$1.standardFunctionAsync(e,t,(async(r$1,s,o)=>{ae$1(o,1,2,e,t);const f={minsize:-1,maxsize:-1,types:null,returnMetadata:!1};if(o.length>1)if(o[1]instanceof N){if(o[1].hasField("minsize")&&(f.minsize=ge(o[1].field("minsize"))),o[1].hasField("metadata")&&(f.returnMetadata=Ne(o[1].field("metadata"))),o[1].hasField("maxsize")&&(f.maxsize=ge(o[1].field("maxsize"))),o[1].hasField("types")){const e=Re(o[1].field("types"),!1);e.length>0&&(f.types=e);}}else if(null!==o[1])throw new a(e,r.InvalidParameter,t);if(H(o[0])){let t=o[0]._layer;return t instanceof Ze&&(t=T(t,e.spatialReference,["*"],!0,e.lrucache,e.interceptor)),null===t?[]:!1===B(t)?[]:(await t.load(),t.queryAttachments(o[0].field(t.objectIdField),f.minsize,f.maxsize,f.types,f.returnMetadata))}if(null===o[0])return [];throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"attachments",min:1,max:2}),q$1.functions.featuresetbyrelationshipname=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{ae$1(s,2,4,e,t);const o=s[0],d=me(s[1]);let c=P(s[2],null);const p=Ne(P(s[3],!0));if(null===c&&(c=["*"]),!1===U(c))throw new a(e,r.InvalidParameter,t);if(null===s[0])return null;if(!H(s[0]))throw new a(e,r.InvalidParameter,t);let y=o._layer;if(y instanceof Ze&&(y=T(y,e.spatialReference,["*"],!0,e.lrucache,e.interceptor)),null===y)return null;if(!1===B(y))return null;y=await y.load();const h=y.relationshipMetaData().filter((e=>e.name===d));if(0===h.length)return null;if(void 0!==h[0].relationshipTableId&&null!==h[0].relationshipTableId&&h[0].relationshipTableId>-1)return E(y,h[0],o.field(y.objectIdField),y.spatialReference,c,p,e.lrucache,e.interceptor);let F=y.serviceUrl();if(!F)return null;F="/"===F.charAt(F.length-1)?F+h[0].relatedTableId.toString():F+"/"+h[0].relatedTableId.toString();const I=await N$1(F,y.spatialReference,c,p,e.lrucache,e.interceptor);await I.load();let D=I.relationshipMetaData();if(D=D.filter((e=>e.id===h[0].id)),!1===o.hasField(h[0].keyField)||null===o.field(h[0].keyField)){const e=await y.getFeatureByObjectId(o.field(y.objectIdField),[h[0].keyField]);if(e){const t=O$1.create(D[0].keyField+"= @id",I.getFieldsIndex(),I.dateFieldsTimeZoneDefaultUTC);return t.parameters={id:e.attributes[h[0].keyField]},I.filter(t)}return new u({parentfeatureset:I})}const T$1=O$1.create(D[0].keyField+"= @id",I.getFieldsIndex(),I.dateFieldsTimeZoneDefaultUTC);return T$1.parameters={id:o.field(h[0].keyField)},I.filter(T$1)}))},q$1.signatures.push({name:"featuresetbyrelationshipname",min:2,max:4}),q$1.functions.featuresetbyassociation=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{ae$1(s,2,3,e,t);const o=s[0],f=me(P(s[1],"")).toLowerCase(),u=G(s[2])?me(s[2]):null;if(null===s[0])return null;if(!H(s[0]))throw new a(e,r.InvalidParameter,t);let c=o._layer;if(c instanceof Ze&&(c=T(c,e.spatialReference,["*"],!0,e.lrucache,e.interceptor)),null===c)return null;if(!1===B(c))return null;await c.load();const p=c.serviceUrl(),y$2=await O(p,e.spatialReference);let F=null,I$1=null,D=!1;if(null!==u&&""!==u&&void 0!==u){for(const e of y$2.terminals)e.terminalName===u&&(I$1=e.terminalId);null===I$1&&(D=!0);}const T$1=y$2.associations.getFieldsIndex(),E=T$1.get("TOGLOBALID").name,A=T$1.get("FROMGLOBALID").name,x=T$1.get("TOTERMINALID").name,L$1=T$1.get("FROMTERMINALID").name,S=T$1.get("FROMNETWORKSOURCEID").name,C=T$1.get("TONETWORKSOURCEID").name,v$1=T$1.get("ASSOCIATIONTYPE").name,P$1=T$1.get("ISCONTENTVISIBLE").name,k$1=T$1.get("OBJECTID").name;for(const e of c.fields)if("global-id"===e.type){F=o.field(e.name);break}let O$2=null,z=new B$1(new y({name:"percentalong",alias:"percentalong",type:"double"}),O$1.create("0",y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC)),H$1=new B$1(new y({name:"side",alias:"side",type:"string"}),O$1.create("''",y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC));const W="globalid",G$1="globalId",K={};for(const e in y$2.lkp)K[e]=y$2.lkp[e].sourceId;const q=new b(new y({name:"classname",alias:"classname",type:"string"}),null,K);let B$2="";switch(f){case"midspan":{B$2=`((${E}='${F}') OR ( ${A}='${F}')) AND (${v$1} IN (5))`,q.codefield=O$1.create(`CASE WHEN (${E}='${F}') THEN ${S} ELSE ${C} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC);const e=y$1(L.findField(y$2.associations.fields,A));e.name=W,e.alias=W,O$2=new B$1(e,O$1.create(`CASE WHEN (${A}='${F}') THEN ${E} ELSE ${A} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC)),z=y$2.unVersion>=4?new I(L.findField(y$2.associations.fields,T$1.get("PERCENTALONG").name)):new B$1(new y({name:"percentalong",alias:"percentalong",type:"double"}),O$1.create("0",y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC));break}case"junctionedge":{B$2=`((${E}='${F}') OR ( ${A}='${F}')) AND (${v$1} IN (4,6))`,q.codefield=O$1.create(`CASE WHEN (${E}='${F}') THEN ${S} ELSE ${C} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC);const e=y$1(L.findField(y$2.associations.fields,A));e.name=W,e.alias=W,O$2=new B$1(e,O$1.create(`CASE WHEN (${A}='${F}') THEN ${E} ELSE ${A} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC)),H$1=new B$1(new y({name:"side",alias:"side",type:"string"}),O$1.create(`CASE WHEN (${v$1}=4) THEN 'from' ELSE 'to' END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC));break}case"connected":{let e=`${E}='@T'`,t=`${A}='@T'`;null!==I$1&&(e+=` AND ${x}=@A`,t+=` AND ${L$1}=@A`),B$2="(("+e+") OR ("+t+"))",B$2=v(B$2,"@T",F??""),e=v(e,"@T",F??""),null!==I$1&&(e=v(e,"@A",I$1.toString()),B$2=v(B$2,"@A",I$1.toString())),q.codefield=O$1.create("CASE WHEN "+e+` THEN ${S} ELSE ${C} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC);const n=y$1(L.findField(y$2.associations.fields,A));n.name=W,n.alias=W,O$2=new B$1(n,O$1.create("CASE WHEN "+e+` THEN ${A} ELSE ${E} END`,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC));break}case"container":B$2=`${E}='${F}' AND ${v$1} = 2`,null!==I$1&&(B$2+=` AND ${x} = `+I$1.toString()),q.codefield=S,B$2="( "+B$2+" )",O$2=new k(L.findField(y$2.associations.fields,A),W,W);break;case"content":B$2=`(${A}='${F}' AND ${v$1} = 2)`,null!==I$1&&(B$2+=` AND ${L$1} = `+I$1.toString()),q.codefield=C,B$2="( "+B$2+" )",O$2=new k(L.findField(y$2.associations.fields,E),W,W);break;case"structure":B$2=`(${E}='${F}' AND ${v$1} = 3)`,null!==I$1&&(B$2+=` AND ${x} = `+I$1.toString()),q.codefield=S,B$2="( "+B$2+" )",O$2=new k(L.findField(y$2.associations.fields,A),W,G$1);break;case"attached":B$2=`(${A}='${F}' AND ${v$1} = 3)`,null!==I$1&&(B$2+=` AND ${L$1} = `+I$1.toString()),q.codefield=C,B$2="( "+B$2+" )",O$2=new k(L.findField(y$2.associations.fields,E),W,G$1);break;default:throw new a(e,r.InvalidParameter,t)}D&&(B$2="1 <> 1");return new L({parentfeatureset:y$2.associations,adaptedFields:[new I(L.findField(y$2.associations.fields,k$1)),new I(L.findField(y$2.associations.fields,P$1)),O$2,H$1,q,z],extraFilter:B$2?O$1.create(B$2,y$2.associations.getFieldsIndex(),y$2.associations.dateFieldsTimeZoneDefaultUTC):null})}))},q$1.signatures.push({name:"featuresetbyassociation",min:2,max:6}),q$1.functions.groupby=function(e,t){return q$1.standardFunctionAsync(e,t,(async(r$1,s,o)=>{if(ae$1(o,3,3,e,t),!B(o[0]))throw new a(e,r.InvalidParameter,t);const l=await o[0].load(),f=[],u=[];let d=!1,c=[];if(G(o[1]))c.push(o[1]);else if(o[1]instanceof N)c.push(o[1]);else if(U(o[1]))c=o[1];else {if(!Q(o[1]))throw new a(e,r.InvalidParameter,t);c=o[1].toArray();}for(const m of c)if(G(m)){const e=O$1.create(me(m),l.getFieldsIndex(),l.dateFieldsTimeZoneDefaultUTC),t=!0===D$1(e)?me(m):"%%%%FIELDNAME";f.push({name:t,expression:e}),"%%%%FIELDNAME"===t&&(d=!0);}else {if(!(m instanceof N))throw new a(e,r.InvalidParameter,t);{const n=m.hasField("name")?m.field("name"):"%%%%FIELDNAME",r$1=m.hasField("expression")?m.field("expression"):"";if("%%%%FIELDNAME"===n&&(d=!0),!n)throw new a(e,r.InvalidParameter,t);f.push({name:n,expression:O$1.create(r$1||n,l.getFieldsIndex(),l.dateFieldsTimeZoneDefaultUTC)});}}if(c=[],G(o[2]))c.push(o[2]);else if(U(o[2]))c=o[2];else if(Q(o[2]))c=o[2].toArray();else {if(!(o[2]instanceof N))throw new a(e,r.InvalidParameter,t);c.push(o[2]);}for(const m of c){if(!(m instanceof N))throw new a(e,r.InvalidParameter,t);{const n=m.hasField("name")?m.field("name"):"",r$1=m.hasField("statistic")?m.field("statistic"):"",s=m.hasField("expression")?m.field("expression"):"";if(!n||!r$1||!s)throw new a(e,r.InvalidParameter,t);u.push({name:n,statistic:r$1.toLowerCase(),expression:O$1.create(s,l.getFieldsIndex(),l.dateFieldsTimeZoneDefaultUTC)});}}if(d){const e={};for(const n of l.fields)e[n.name.toLowerCase()]=1;for(const n of f)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);for(const n of u)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of f)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString();}}for(const t of f)await ee(t.expression,q$1,e);for(const t of u)await ee(t.expression,q$1,e);return o[0].groupby(f,u)}))},q$1.signatures.push({name:"groupby",min:3,max:3}),q$1.functions.distinct=function(e,t){return q$1.standardFunctionAsync(e,t,(async(r$1,s,o)=>{if(B(o[0])){ae$1(o,2,2,e,t);const r$1=await o[0].load(),s=[];let l=[];if(G(o[1]))l.push(o[1]);else if(o[1]instanceof N)l.push(o[1]);else if(U(o[1]))l=o[1];else {if(!Q(o[1]))throw new a(e,r.InvalidParameter,t);l=o[1].toArray();}let f=!1;for(const o of l)if(G(o)){const e=O$1.create(me(o),r$1.getFieldsIndex(),r$1.dateFieldsTimeZoneDefaultUTC),t=!0===D$1(e)?me(o):"%%%%FIELDNAME";s.push({name:t,expression:e}),"%%%%FIELDNAME"===t&&(f=!0);}else {if(!(o instanceof N))throw new a(e,r.InvalidParameter,t);{const n=o.hasField("name")?o.field("name"):"%%%%FIELDNAME",l=o.hasField("expression")?o.field("expression"):"";if("%%%%FIELDNAME"===n&&(f=!0),!n)throw new a(e,r.InvalidParameter,t);s.push({name:n,expression:O$1.create(l||n,r$1.getFieldsIndex(),r$1.dateFieldsTimeZoneDefaultUTC)});}}if(f){const e={};for(const n of r$1.fields)e[n.name.toLowerCase()]=1;for(const n of s)"%%%%FIELDNAME"!==n.name&&(e[n.name.toLowerCase()]=1);let t=0;for(const n of s)if("%%%%FIELDNAME"===n.name){for(;1===e["field_"+t.toString()];)t++;e["field_"+t.toString()]=1,n.name="FIELD_"+t.toString();}}for(const t of s)await ee(t.expression,q$1,e);return o[0].groupby(s,[])}return X(o)}))},q$1.functions.getfeaturesetinfo=function(e,t){return q$1.standardFunctionAsync(e,t,(async(a,i,r)=>{if(ae$1(r,1,1,e,t),!B(r[0]))return null;const s=await r[0].getFeatureSetInfo();return s?N.convertObjectToArcadeDictionary({layerId:s.layerId,layerName:s.layerName,itemId:s.itemId,serviceLayerUrl:s.serviceLayerUrl,webMapLayerId:s.webMapLayerId??null,webMapLayerTitle:s.webMapLayerTitle??null,className:null,objectClassId:null},He(e),!1,!1):null}))},q$1.signatures.push({name:"getfeaturesetinfo",min:1,max:1}),q$1.functions.filterbysubtypecode=function(e,t){return q$1.standardFunctionAsync(e,t,(async(n,r$1,s)=>{if(ae$1(s,2,2,e,t),B(s[0])){const n=await s[0].load(),r$1=s[1];if(!V(r$1))throw new a(e,r.InvalidParameter,t);if(n.subtypeField){const e=O$1.create(`${n.subtypeField}= ${s[1]}`,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC);return new c({parentfeatureset:s[0],whereclause:e})}if(null===n.typeIdField||""===n.typeIdField)throw new a(e,r.FeatureSetDoesNotHaveSubtypes,t);const o=O$1.create(`${n.typeIdField}= ${s[1]}`,n.getFieldsIndex(),n.dateFieldsTimeZoneDefaultUTC);return new c({parentfeatureset:s[0],whereclause:o})}throw new a(e,r.InvalidParameter,t)}))},q$1.signatures.push({name:"filterbysubtypecode",min:2,max:2}));}

export { le as registerFunctions };
