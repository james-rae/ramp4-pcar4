{"version":3,"file":"projection-BITClnVQ.js","sources":["../../node_modules/@arcgis/core/geometry/support/meshUtils/projection.js"],"sourcesContent":["/*\nAll material copyright ESRI, All Rights Reserved, unless otherwise specified.\nSee https://js.arcgis.com/4.30/esri/copyright.txt for details.\n*/\nimport{hasScaling as r,deg2rad as t}from\"../../../core/mathUtils.js\";import{normalFromMat4 as o,fromMat4 as e}from\"../../../core/libs/gl-matrix-2/math/mat3.js\";import{create as n}from\"../../../core/libs/gl-matrix-2/factories/mat3f64.js\";import{multiply as i,equals as c,invert as a}from\"../../../core/libs/gl-matrix-2/math/mat4.js\";import{IDENTITY as f,create as s}from\"../../../core/libs/gl-matrix-2/factories/mat4f64.js\";import{t as l,n as m,e as u}from\"../../../chunks/vec32.js\";import{ZEROS as p,create as T}from\"../../../core/libs/gl-matrix-2/factories/vec3f64.js\";import{canProjectWithoutEngine as y}from\"../../projection.js\";import{getSphericalPCPF as A}from\"../../spatialReferenceEllipsoidUtils.js\";import{computeTranslationToOriginAndRotation as d}from\"../../projection/computeTranslationToOriginAndRotation.js\";import{projectBuffer as P}from\"../../projection/projectBuffer.js\";import{newDoubleArray as g,copyInto as j}from\"../DoubleArray.js\";import{earth as M}from\"../Ellipsoid.js\";import{isCGCS2000 as h,isMars as N,isMoon as R}from\"../spatialReferenceUtils.js\";import{y2lat as O}from\"../webMercatorUtils.js\";import{BufferViewVec3f as F,BufferViewVec3f64 as E}from\"../buffer/BufferView.js\";import{t as _,n as b,a as x}from\"../../../chunks/vec3.js\";import{t as C}from\"../../../chunks/vec4.js\";const L=\"Projection may be possible after calling projection.load().\";function S(r,t,o,e){r.error(`Failed to project from (wkid:${t.wkid}) to (wkid:${o.wkid}).${e?\" \":\"\"}${e}`)}function v(r,t,o,e,n){return I(z.TO_PCPF,F.fromTypedArray(r),D.NORMAL,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n))?n:null}function k(r,t,o,e,n){return I(z.FROM_PCPF,F.fromTypedArray(r),D.NORMAL,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n))?n:null}function w(r,t,o){return P(r,t,0,o,A(t),0,r.length/3)?o:null}function G(r,t,o){return P(r,A(o),0,t,o,0,r.length/3)?t:null}function V(t,e,n){return o(or,n),_(e,t,or),r(or)&&b(e,e),e}function B(t,o,n){return e(or,n),C(o,t,or),r(or)&&b(o,o,4),o}function U(r,o,e,n){const i=o===D.NORMAL;return W(r,o,e,((r,o)=>{const e=Math.cos(t(r));o[0]=i?e:1/e,o[1]=1}),n)}function $(r,t,o,e){const n=t===D.NORMAL;return W(r,t,o,((r,t)=>{const o=Math.cosh(-r/M.radius);t[0]=1,t[1]=n?o:1/o}),e)}function W(r,t,o,e,n){const i=t===D.NORMAL?3:4,c=[0,0];for(let a=0,f=1;a<r.length;a+=i,f+=3){e(o[f],c);const t=r[a]*c[0],s=r[a+1]*c[1],l=r[a+2],m=1/Math.sqrt(t*t+s*s+l*l);n[a]=t*m,n[a+1]=s*m,n[a+2]=l*m,4===i&&(n[a+3]=r[a+3])}return n}function Y(r,t,o,e,n){if(!I(z.TO_PCPF,F.fromTypedArray(r,4*Float32Array.BYTES_PER_ELEMENT),D.TANGENT,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n,4*Float32Array.BYTES_PER_ELEMENT)))return null;for(let i=3;i<r.length;i+=4)n[i]=r[i];return n}function q(r,t,o,e,n){if(!I(z.FROM_PCPF,F.fromTypedArray(r,16),D.TANGENT,E.fromTypedArray(t),E.fromTypedArray(o),e,F.fromTypedArray(n,16)))return null;for(let i=3;i<r.length;i+=4)n[i]=r[i];return n}var D,z;function H(r,t,n,i,c){switch(d(i,n,tr,i),r===z.FROM_PCPF&&a(tr,tr),t){case D.NORMAL:return o(c,tr);case D.TANGENT:return e(c,tr)}}function I(r,t,o,e,n,i,c){if(!t)return;const a=e.count,f=A(i);if(X(i))for(let s=0;s<a;s++)n.getVec(s,Z),t.getVec(s,rr),l(rr,rr,H(r,o,Z,f,or)),c.setVec(s,rr);else for(let s=0;s<a;s++){n.getVec(s,Z),t.getVec(s,rr);const i=O(e.get(s,1));let a=Math.cos(i);o===D.TANGENT!=(r===z.TO_PCPF)&&(a=1/a),H(r,o,Z,f,or),r===z.TO_PCPF?(or[0]*=a,or[1]*=a,or[2]*=a,or[3]*=a,or[4]*=a,or[5]*=a):(or[0]*=a,or[3]*=a,or[6]*=a,or[1]*=a,or[4]*=a,or[7]*=a),l(rr,rr,or),m(rr,rr),c.setVec(s,rr)}return c}function J(r){return\"local\"===r.vertexSpace.type?K(r):Q(r)}function K({vertexSpace:r,transform:t,inSpatialReference:o,outSpatialReference:e,localMode:n,outPositions:c,positions:a}){const s=r.origin??p,l=null!=r.origin?t?.localMatrix??f:f,m=A(o),u=e.isWebMercator&&n||!y(o,m)?o:m;d(o,s,tr,u),i(tr,tr,l);const T=c??g(a.length);return x(T,a,tr),P(T,u,0,T,e,0,T.length/3),T}function Q({vertexSpace:r,transform:t,outPositions:o,positions:e,inSpatialReference:n,outSpatialReference:i}){const a=null!=r.origin?t?.localMatrix??f:f,s=o??g(e.length);c(a,f)?j(s,e):x(s,e,a);const l=r.origin??p;if(!u(l,p)){const[r,t,o]=l;for(let e=0;e<s.length;e+=3)s[e]+=r,s[e+1]+=t,s[e+2]+=o}return P(s,n,0,s,i,0,s.length/3)?s:null}function X(r){return r.isWGS84||h(r)||N(r)||R(r)}!function(r){r[r.NORMAL=0]=\"NORMAL\",r[r.TANGENT=1]=\"TANGENT\"}(D||(D={})),function(r){r[r.TO_PCPF=0]=\"TO_PCPF\",r[r.FROM_PCPF=1]=\"FROM_PCPF\"}(z||(z={}));const Z=T(),rr=T(),tr=s(),or=n();export{D as VectorType,L as loadProjectErrorMessage,S as logProjectionError,J as project,G as projectFromPCPF,k as projectNormalFromPCPF,v as projectNormalToPCPF,q as projectTangentFromPCPF,Y as projectTangentToPCPF,w as projectToPCPF,V as transformNormal,B as transformTangent,U as transformVectorENUPlateCarree,$ as transformVectorWMPlateCarree};\n"],"names":["L","S","t","o","v","I","z","F","D","E","k","w","P","A","G","V","e","n","or","_","r","b","B","C","Y","q","H","i","c","d","tr","a","f","X","Z","rr","l","O","m","J","K","Q","s","p","u","y","T","g","x","j","h","N","R"],"mappings":"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","x_google_ignoreList":[0]}