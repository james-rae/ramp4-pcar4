const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["./knowledgeGraphService-DGhkZBV1.js","./main-DsiOxGaZ.js","./preload-helper-DMGCcr4D.js","./main-DZFs8ecF.css","./normalizeUtils-Cq0PErW6.js","./Cyclical-iQkhmwFT.js","./normalizeUtilsCommon-CL1A022Q.js","./utils-iXEZbz2h.js","./utils-DJdENeKf.js","./Field-aFIwaSSJ.js","./fieldType-B2cvn2Df.js","./networkEnums-DidsERWZ.js","./FeatureSet-C4LB3FI6.js","./GPMessage-D9Lep2Im.js","./Relationship-Bpt60Qmr.js"])))=>i.map(i=>d[i]);
import{_ as G}from"./preload-helper-DMGCcr4D.js";import{M as _,eX as g,eZ as S,e2 as A,eY as x,B as N,ac as q,D as I,e_ as J,e$ as j}from"./main-DsiOxGaZ.js";import{t as B}from"./arcade-eWMTdksl.js";import{o as P,g as T,k as L,z as W,p as b,c as Q,l as k,m as V,w as O,K as U,U as E}from"./Dictionary-Cdly82gg.js";import{n as l}from"./enum-CaGeEKDL.js";import{l as z}from"./portalUtils-2MfCWxfI.js";import{L as C,W as X,G as Y}from"./projectionUtils-CbX_T-iB.js";import Z from"./PortalItem-DE_QPgX6.js";import{p as H,n as $}from"./project-CJJQ-8Wn.js";import{p as tt,a as et,e as rt,i as nt,b as it}from"./Relationship-Bpt60Qmr.js";import"./arcadeEnvironment-pavTXgDS.js";import"./Feature-DJegk50Y.js";import"./TimeOnly-CC3deHic.js";import"./UnknownTimeZone-Drf3K1nu.js";import"./featureConversionUtils-BLYY_jg5.js";import"./OptimizedFeature-BIX5925n.js";import"./memoryEstimations-h5ttCRt_.js";import"./OptimizedGeometry-DgOYyJMy.js";import"./OptimizedFeatureSet-BR8EEvDc.js";import"./FieldsIndex-iSIX73lV.js";import"./timeZoneUtils-Bto1APsr.js";import"./aiServices-B7tSybWm.js";import"./commonProperties-DHiB1uzW.js";import"./utils-iXEZbz2h.js";import"./ImmutableArray-BPVd6ESQ.js";import"./shared-DYdRJQAQ.js";import"./Field-aFIwaSSJ.js";import"./fieldType-B2cvn2Df.js";import"./WhereClause-6-47ICKe.js";import"./streamLayerUtils-DFlbJ4P1.js";import"./unitConversion-CEXffLmK.js";import"./number-DlxxYfWG.js";import"./uuid-Oe6SV2kF.js";import"./projectBuffer-CAuYdJOv.js";import"./zscale-CY1ZfBj_.js";import"./utils-DJdENeKf.js";let u=null;async function ot(t){const e=q.geometryServiceUrl??"";if(!e){Y()||await C();for(const r of t)r.container[r.indexer]=X(r.container[r.indexer],I.WGS84);return}const n=t.map(r=>r.container[r.indexer]),o=new H({geometries:n,outSpatialReference:I.WGS84}),s=await $(e,o);for(let r=0;r<s.length;r++){const i=t[r];i.container[i.indexer]=s[r]}}async function D(t,e){const n=new Z({portal:t,id:e});return await n.load(),u===null&&(u=await G(()=>import("./knowledgeGraphService-DGhkZBV1.js").then(o=>o.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url)),await u.fetchKnowledgeGraph(n.url)}function v(t,e,n,o,s){if(t===null)return null;if(g(t)||A(t))return t;if(k(t)||k(t))return t.toJSDate();if(V(t))return t.toStorageFormat();if(O(t))return t.toStorageString();if(U(t)){const r={};for(const i of t.keys())r[i]=v(t.field(i),e,n,o,s),r[i]instanceof x&&s.push({container:r,indexer:i});return r}if(S(t)){const r=t.map(i=>v(i,e,n,o,s));for(let i=0;i<r.length;i++)r[i]instanceof x&&s.push({container:r,indexer:i});return r}return E(t)?t.spatialReference.isWGS84?t:t.spatialReference.isWebMercator&&e?N(t):t:void 0}function at(t,e){if(!t)return t;if(t.spatialReference.isWGS84&&e.spatialReference.isWebMercator)return j(t);if(t.spatialReference.equals(e.spatialReference))return t;throw new l(e,"WrongSpatialReference",null)}function y(t,e){if(!t)return null;const n={};for(const o in t)n[o]=c(t[o],e);return n}function c(t,e){return t===null?null:S(t)?t.map(n=>c(n,e)):t instanceof et?{graphTypeName:t.typeName,id:t.id,graphType:"entity",properties:y(t.properties,e)}:t instanceof rt?{graphType:"object",properties:y(t.properties,e)}:t instanceof nt?{graphTypeName:t.typeName,id:t.id,graphType:"relationship",originId:t.originId??null,destinationId:t.destinationId??null,properties:y(t.properties,e)}:t instanceof it?{graphType:"path",path:t.path?t.path.map(n=>c(n,e)):null}:E(t)?at(t,e):g(t)||A(t)||J(t)?t:null}function Qt(t){t.mode==="async"&&(t.functions.knowledgegraphbyportalitem=function(e,n){return t.standardFunctionAsync(e,n,(o,s,r)=>{if(P(r,2,2,e,n),r[0]===null)throw new l(e,"PortalRequired",n);if(r[0]instanceof B){const m=T(r[1]);let f;return f=e.services?.portal?e.services.portal:_.getDefault(),D(z(r[0],f),m)}if(g(r[0])===!1)throw new l(e,"InvalidParameter",n);const i=T(r[0]);return D(e.services?.portal??_.getDefault(),i)})},t.signatures.push({name:"knowledgegraphbyportalitem",min:2,max:2}),t.functions.querygraph=function(e,n){return t.standardFunctionAsync(e,n,async(o,s,r)=>{P(r,2,4,e,n);const i=r[0];if(!L(i))throw new l(e,"InvalidParameter",n);const m=r[1];if(!g(m))throw new l(e,"InvalidParameter",n);u===null&&(u=await G(()=>import("./knowledgeGraphService-DGhkZBV1.js").then(a=>a.k),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14]),import.meta.url));let f=null;const d=W(r[2],null);if(!(d instanceof b||d===null))throw new l(e,"InvalidParameter",n);if(d){let a=[];f=v(d,!0,!1,e,a),a=a.filter(p=>!p.container[p.indexer].spatialReference.isWGS84),a.length>0&&await ot(a)}const F=W(r[3],!1),R=new tt({openCypherQuery:m,bindParameters:f,provenanceBehavior:F?"include":"exclude"});(i?.serviceDefinition?.currentVersion??11.3)>11.2&&(R.outputSpatialReference=e.spatialReference);const K=(await u.executeQueryStreaming(i,R)).resultRowsStream.getReader(),w=[];try{for(;;){const{done:a,value:p}=await K.read();if(a)break;if(S(p))for(const h of p)w.push(c(h,e));else{const h=[];for(const M of p)h.push(c(p[M],e));w.push(h)}}}catch(a){throw a}return b.convertJsonToArcade(w,Q(e),!1,!0)})},t.signatures.push({name:"querygraph",min:2,max:4}))}export{Qt as registerFunctions};
